import{e as h,c as f}from"./subclass-f7409b1b.js";import{y as _,S as E}from"./JSONSupport-acf2865c.js";import{v as g,p as b,d as w,m as M,l as $,r as C,e as L}from"./promiseUtils-1d963c7c.js";function T(e,r,o){return g(e.map((s,t)=>r.apply(o,[s,t])))}async function z(e,r,o){return(await g(e.map((s,t)=>r.apply(o,[s,t])))).map(s=>s.value)}function v(e){return{ok:!0,value:e}}function y(e){return{ok:!1,error:e}}function k(e){return e!=null&&e.ok===!0?e.value:null}function x(e){return e!=null&&e.ok===!1?e.error:null}async function O(e){if(e==null)return{ok:!1,error:new Error("no promise provided")};try{return v(await e)}catch(r){return y(r)}}async function R(e){try{return v(await e)}catch(r){return b(r),y(r)}}function U(e,r){return new u(e,r)}let u=class extends E{get value(){return k(this._result)}get error(){return x(this._result)}get finished(){return this._result!=null}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=w(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:o}=this._abortController;this.promise=e(o),this.promise.then(s=>{this._result=v(s),this._cleanup()},s=>{this._result=y(s),this._cleanup()}),this._abortHandle=M(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=$(this._abortHandle),this._abortController=null}};h([_()],u.prototype,"value",null),h([_()],u.prototype,"error",null),h([_()],u.prototype,"finished",null),h([_()],u.prototype,"promise",void 0),h([_()],u.prototype,"_result",void 0),u=h([f("esri.core.asyncUtils.ReactiveTask")],u);class m{constructor(){this._emitter=new m.EventEmitter(this)}emit(r,o){return this._emitter.emit(r,o)}on(r,o){return this._emitter.on(r,o)}once(r,o){return this._emitter.once(r,o)}hasEventListener(r){return this._emitter.hasEventListener(r)}}(function(e){class r{constructor(t=null){this._target=t,this._listenersMap=null}clear(){var t;(t=this._listenersMap)==null||t.clear(),this._listenersMap=null}destroy(){this.clear()}emit(t,i){var p;let n=(p=this._listenersMap)==null?void 0:p.get(t);if(!n)return!1;const a=this._target||this;let l=!1;for(const c of n.slice()){const d="deref"in c?c.deref():c;d?d==null||d.call(a,i):l=!0}return l&&(n=n.filter(c=>!("deref"in c)||c.deref()!=null),this._listenersMap.set(t,n)),n.length>0}on(t,i){if(Array.isArray(t)){const a=t.map(l=>this.on(l,i));return C(a)}if(t.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const n=this._listenersMap.get(t)||[];return n.push(i),this._listenersMap.set(t,n),L(()=>{var p;const a=(p=this._listenersMap)==null?void 0:p.get(t),l=(a==null?void 0:a.indexOf(i))??-1;l>=0&&a.splice(l,1)})}once(t,i){const n=this.on(t,a=>{n.remove();const l="deref"in i?i.deref():i;l==null||l.call(null,a)});return n}hasEventListener(t){var n;const i=(n=this._listenersMap)==null?void 0:n.get(t);return i!=null&&i.length>0}}e.EventEmitter=r,e.EventedMixin=s=>{let t=class extends s{constructor(){super(...arguments),this._emitter=new r}destroy(){this._emitter.clear()}emit(i,n){return this._emitter.emit(i,n)}on(i,n){return this._emitter.on(i,n)}once(i,n){return this._emitter.once(i,n)}hasEventListener(i){return this._emitter.hasEventListener(i)}};return t=h([f("esri.core.Evented")],t),t};let o=class extends E{constructor(){super(...arguments),this._emitter=new m.EventEmitter(this)}destroy(){this._emitter.clear()}emit(s,t){return this._emitter.emit(s,t)}on(s,t){return this._emitter.on(s,t)}once(s,t){return this._emitter.once(s,t)}hasEventListener(s){return this._emitter.hasEventListener(s)}};o=h([f("esri.core.Evented")],o),e.EventedAccessor=o})(m||(m={}));const j=m;export{O as _,T as a,R as b,U as d,j as o,z as p};
