import{e as i,c as m}from"./subclass-f7409b1b.js";import{c as T}from"./Analysis-0a9396e1.js";import{u as j,y as r,S as N}from"./JSONSupport-acf2865c.js";import{i as P,l as C}from"./Clonable-b71fa929.js";import{x as d}from"./promiseUtils-1d963c7c.js";import"./typedArrayUtil-2af43698.js";import"./Error-21d1d076.js";import{j as f}from"./persistable-f801ac25.js";import{x as w}from"./Extent-2b4578b8.js";import{h as O}from"./ElevationInfo-e9f55e40.js";import{V as g}from"./Collection-aa6ef54b.js";import{t as H,n as $}from"./collectionUtils-b6e30316.js";import{d as L,A as R}from"./reactiveUtils-e7d9f86e.js";import{K}from"./projection-41da473c.js";import{a as M,h as V,e as k}from"./aaBoundingBox-7242ce3e.js";import{i as B}from"./elevationInfoUtils-a8638c06.js";import{m as D}from"./MultiOriginJSONSupport-9bd581c6.js";import{b as G}from"./Layer-668dff8a.js";import{u as J}from"./OperationalLayer-04352719.js";import"./Identifiable-1430bdc2.js";import"./time-0817624a.js";import"./MD5-715f37cd.js";import"./multiOriginJSONSupportUtils-c978f4c3.js";import"./request-a10d6950.js";import"./uuid-709b6c67.js";import"./resourceExtension-9d75347b.js";import"./persistableUrlUtils-ca6bb38d.js";import"./SpatialReference-428523ee.js";import"./jsonMap-5ba4a9c2.js";import"./assets-6fd92e57.js";import"./cast-e7a2f9aa.js";import"./fieldUtils-fcb2a714.js";import"./intl-fe039018.js";import"./date-7940da18.js";import"./locale-bde6d0f6.js";import"./datetime-7e00d9ef.js";import"./messages-2d262041.js";import"./mathUtils-19b6edfc.js";import"./geometry-31b45acd.js";import"./Polyline-013cde1f.js";import"./aaBoundingRect-aef00841.js";import"./Axis-30be7e73.js";import"./typeUtils-3056a943.js";import"./lengthUtils-1e9c410b.js";import"./Evented-b5127116.js";import"./SimpleObservable-ae589a25.js";import"./projectBuffer-af7b4ad9.js";import"./zscale-d7e12601.js";import"./Loadable-8a1ead8b.js";import"./Promise-ec74e14b.js";import"./commonProperties-0c35c2c9.js";import"./TimeExtent-579f0e32.js";import"./timeUtils-24502426.js";import"./opacityUtils-f0a081b4.js";function S(t,e){return I(t)===I(e)}function I(t){if(t==null)return null;const e=t.layer!=null?t.layer.id:"";let s=null;return s=t.objectId!=null?t.objectId:t.layer!=null&&"objectIdField"in t.layer&&t.layer.objectIdField!=null&&t.attributes!=null?t.attributes[t.layer.objectIdField]:t.uid,s==null?null:`o-${e}-${s}`}const E={json:{write:{writer:Q,target:{"feature.layerId":{type:[Number,String]},"feature.objectId":{type:[Number,String]}}},origins:{"web-scene":{read:U}}}};function Q(t,e){var s;((s=t==null?void 0:t.layer)==null?void 0:s.objectIdField)!=null&&t.attributes!=null&&(e.feature={layerId:t.layer.id,objectId:t.attributes[t.layer.objectIdField]})}function U(t){if(t.layerId!=null&&t.objectId!=null)return{uid:null,layer:{id:t.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:t.objectId}}}let a=class extends j(P(N)){constructor(e){super(e),this.position=null,this.elevationInfo=null,this.feature=null}equals(e){return d(this.position,e.position)&&d(this.elevationInfo,e.elevationInfo)&&S(this.feature,e.feature)}};i([r({type:w,json:{write:{isRequired:!0}}})],a.prototype,"position",void 0),i([r({type:O}),f()],a.prototype,"elevationInfo",void 0),i([r(E)],a.prototype,"feature",void 0),a=i([m("esri.analysis.LineOfSightAnalysisObserver")],a);const F=a;let p=class extends j(C){constructor(t){super(t),this.position=null,this.elevationInfo=null,this.feature=null}equals(t){return d(this.position,t.position)&&d(this.elevationInfo,t.elevationInfo)&&S(this.feature,t.feature)}};i([r({type:w}),f()],p.prototype,"position",void 0),i([r({type:O}),f()],p.prototype,"elevationInfo",void 0),i([r(E)],p.prototype,"feature",void 0),p=i([m("esri.analysis.LineOfSightAnalysisTarget")],p);const z=p,c=g.ofType(z);let n=class extends T{constructor(e){super(e),this.type="line-of-sight",this.observer=null,this.extent=null}initialize(){this.addHandles(L(()=>this._computeExtent(),e=>{(e==null?void 0:e.pending)==null&&this._set("extent",e!=null?e.extent:null)},R))}get targets(){return this._get("targets")||new c}set targets(e){this._set("targets",$(e,this.targets,c))}get spatialReference(){var e;return((e=this.observer)==null?void 0:e.position)!=null?this.observer.position.spatialReference:null}get requiredPropertiesForEditing(){var e;return[(e=this.observer)==null?void 0:e.position]}async waitComputeExtent(){const e=this._computeExtent();return e!=null?e.pending:Promise.resolve()}_computeExtent(){var b;const e=this.spatialReference;if(((b=this.observer)==null?void 0:b.position)==null||e==null)return null;const s=u=>B(u.position,u.elevationInfo)==="absolute-height",l=this.observer.position,v=M(l.x,l.y,l.z,l.x,l.y,l.z);for(const u of this.targets)if(u.position!=null){const y=K(u.position,e);if(y.pending!=null)return{pending:y.pending,extent:null};if(y.geometry!=null){const{x:q,y:A,z:_}=y.geometry;V(v,[q,A,_])}}const h=k(v,e);return s(this.observer)&&this.targets.every(s)||(h.zmin=void 0,h.zmax=void 0),{pending:null,extent:h}}clear(){this.observer=null,this.targets.removeAll()}};i([r({type:["line-of-sight"]})],n.prototype,"type",void 0),i([r({type:F,json:{read:!0,write:!0}})],n.prototype,"observer",void 0),i([r({cast:H,type:c,nonNullable:!0,json:{read:!0,write:!0}})],n.prototype,"targets",null),i([r({value:null,readOnly:!0})],n.prototype,"extent",void 0),i([r({readOnly:!0})],n.prototype,"spatialReference",null),i([r({readOnly:!0})],n.prototype,"requiredPropertiesForEditing",null),n=i([m("esri.analysis.LineOfSightAnalysis")],n);const x=n,W=g.ofType(z);let o=class extends J(D(G)){constructor(t){super(t),this.type="line-of-sight",this.operationalLayerType="LineOfSightLayer",this.analysis=new x,this.opacity=1}initialize(){this.addHandles(L(()=>this.analysis,(t,e)=>{e!=null&&e.parent===this&&(e.parent=null),t!=null&&(t.parent=this)},R))}async load(){return this.analysis!=null&&this.addResolvingPromise(this.analysis.waitComputeExtent()),this}get observer(){var t;return(t=this.analysis)==null?void 0:t.observer}set observer(t){const{analysis:e}=this;e&&(e.observer=t)}get targets(){return this.analysis!=null?this.analysis.targets:new g}set targets(t){var e;$(t,(e=this.analysis)==null?void 0:e.targets)}get fullExtent(){return this.analysis!=null?this.analysis.extent:null}get spatialReference(){return this.analysis!=null?this.analysis.spatialReference:null}releaseAnalysis(t){this.analysis===t&&(this.analysis=new x)}};i([r({json:{read:!1},readOnly:!0})],o.prototype,"type",void 0),i([r({type:["LineOfSightLayer"]})],o.prototype,"operationalLayerType",void 0),i([r({type:F,json:{read:!0,write:{isRequired:!0,ignoreOrigin:!0}}})],o.prototype,"observer",null),i([r({type:W,json:{read:!0,write:{ignoreOrigin:!0}}})],o.prototype,"targets",null),i([r({nonNullable:!0,json:{read:!1,write:!1}})],o.prototype,"analysis",void 0),i([r({readOnly:!0})],o.prototype,"fullExtent",null),i([r({readOnly:!0})],o.prototype,"spatialReference",null),i([r({readOnly:!0,json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],o.prototype,"opacity",void 0),i([r({type:["show","hide"]})],o.prototype,"listMode",void 0),o=i([m("esri.layers.LineOfSightLayer")],o);const Zt=o;export{Zt as default};
