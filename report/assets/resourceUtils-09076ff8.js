import{V as p,H as R,U as x}from"./request-a10d6950.js";import{a as h}from"./Error-21d1d076.js";import"./typedArrayUtil-2af43698.js";import"./JSONSupport-acf2865c.js";import"./subclass-f7409b1b.js";import"./promiseUtils-1d963c7c.js";import"./time-0817624a.js";async function j(e,t={},r){await e.load(r);const s=p(e.itemUrl,"resources"),{start:a=1,num:d=10,sortOrder:n="asc",sortField:m="resource"}=t,i={query:{start:a,num:d,sortOrder:n,sortField:m,token:e.apiKey},signal:r==null?void 0:r.signal},o=await e.portal.request(s,i);return{total:o.total,nextStart:o.nextStart,resources:o.resources.map(({created:f,size:c,resource:l})=>({created:new Date(f),size:c,resource:e.resourceFromPath(l)}))}}async function T(e,t,r,s){const a=new Map;for(const{resource:n,content:m,compress:i,access:o}of t){if(!n.hasPath())throw new h(`portal-item-resource-${r}:invalid-path`,"Resource does not have a valid path");const[f,c]=g(n.path),l=`${f}/${i??""}/${o??""}`;a.has(l)||a.set(l,{prefix:f,compress:i,access:o,files:[]}),a.get(l).files.push({fileName:c,content:m})}await e.load(s);const d=p(e.userItemUrl,r==="add"?"addResources":"updateResources");for(const{prefix:n,compress:m,access:i,files:o}of a.values())for(let c=0;c<o.length;c+=25){const l=o.slice(c,c+25),u=new FormData;n&&n!=="."&&u.append("resourcesPrefix",n),m&&u.append("compress","true"),i&&u.append("access",i);let y=0;for(const{fileName:v,content:b}of l)u.append("file"+ ++y,b,v);u.append("f","json"),await e.portal.request(d,{method:"post",body:u,signal:s==null?void 0:s.signal})}}async function A(e,t,r){if(!t.hasPath())throw new h("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(r);const s=p(e.userItemUrl,"removeResources");await e.portal.request(s,{method:"post",query:{resource:t.path},signal:r==null?void 0:r.signal}),t.portalItem=null}async function N(e,t){await e.load(t);const r=p(e.userItemUrl,"removeResources");return e.portal.request(r,{method:"post",query:{deleteAll:!0},signal:t==null?void 0:t.signal})}function g(e){const t=e.lastIndexOf("/");return t===-1?[".",e]:[e.slice(0,t),e.slice(t+1)]}function w(e){const[t,r]=P(e),[s,a]=g(t);return[s,a,r]}function P(e){const t=R(e);return t==null?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function z(e){return e.type==="blob"?e.blob:e.type==="json"?new Blob([e.jsonString],{type:"application/json"}):(await x(e.url,{responseType:"blob"})).data}function B(e,t){if(!e.hasPath())return null;const[r,,s]=w(e.path);return e.portalItem.resourceFromPath(p(r,t+s))}function D(e,t){if(!e.hasPath())return null;const[r,,s]=w(e.path);return e.portalItem.resourceFromPath(p(r,t+s))}export{T as addOrUpdateResources,z as contentToBlob,j as fetchResources,B as getSiblingOfSameType,D as getSiblingOfSameTypeI,N as removeAllResources,A as removeResource,w as splitPrefixFileNameAndExtension};
