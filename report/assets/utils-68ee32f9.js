import{U as C,_ as j}from"./request-a10d6950.js";import{u}from"./Color-e1a6dfab.js";import{x as y,S as p,l as I}from"./symbols-b3e075ad.js";import{a as v}from"./Evented-b5127116.js";import"./typedArrayUtil-2af43698.js";import{_ as z}from"./mathUtils-19b6edfc.js";import{i as P}from"./BlendLayer-2e0705c7.js";import{M as _,f as E,m as R,y as O,b as A}from"./utils-064c64c4.js";import{n as U}from"./assets-6fd92e57.js";import{e as D}from"./LRUCache-000d0e19.js";import{u as f}from"./screenUtils-7afeb41c.js";function k(t){const o=[];return b(_(t),o),o.length?new u(E(o[0])):null}function b(t,o){var l;if(!t)return;let r;r=t.type==="CIMTextSymbol"?t.symbol:t;const n=t.type==="CIMPolygonSymbol";if(r!=null&&r.symbolLayers){for(const e of r.symbolLayers)if(!(e.colorLocked||n&&(R(e)||O(e)&&e.markerPlacement&&A(e.markerPlacement))))switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor&&w(o,e.tintColor);break;case"CIMVectorMarker":(l=e.markerGraphics)==null||l.forEach(i=>{b(i.symbol,o)});break;case"CIMSolidStroke":case"CIMSolidFill":w(o,e.color);break;case"CIMHatchFill":b(e.lineSymbol,o)}}}function w(t,o){for(const r of t)if(r.join(".")===o.join("."))return;t.push(o)}const $="picture-fill",S="simple-fill",F="simple-line",x="simple-marker",N="text",T="cim",g=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),d=new D(1e3);function yt(t){const o=t.style;let r=null;if(t)switch(t.type){case x:o!=="cross"&&o!=="x"&&(r=t.color);break;case S:o&&o!=="solid"?o!=="none"&&(r={type:"pattern",x:0,y:0,src:U(`esri/symbols/patterns/${o}.png`),width:5,height:5}):r=t.color;break;case $:r={type:"pattern",src:t.url,width:f(t.width)*t.xscale,height:f(t.height)*t.yscale,x:f(t.xoffset),y:f(t.yoffset)};break;case N:r=t.color;break;case T:r=k(t)}return r}function pt(t,o){const r=t+"-"+o;return d.get(r)!==void 0?Promise.resolve(d.get(r)):C(t,{responseType:"image"}).then(n=>{const l=n.data,e=l.naturalWidth,i=l.naturalHeight,a=document.createElement("canvas");a.width=e,a.height=i;const s=a.getContext("2d");s.fillStyle=o,s.fillRect(0,0,e,i),s.globalCompositeOperation="destination-in",s.drawImage(l,0,0);const c=a.toDataURL();return d.put(r,c),c})}function H(t){if(!t)return null;let o=null;switch(t.type){case S:case $:case x:o=H(t.outline);break;case F:{const r=f(t.width);t.style!=null&&t.style!=="none"&&r!==0&&(o={color:t.color,style:G(t.style),width:r,cap:t.cap,join:t.join==="miter"?f(t.miterLimit):t.join},o.dashArray=V(o).join(",")||"none");break}default:o=null}return o}function V(t){if(!(t!=null&&t.style))return[];const{dashArray:o,style:r,width:n}=t;if(typeof o=="string"&&o!=="none")return o.split(",").map(i=>Number(i));const l=n??0,e=g.has(r)?g.get(r).map(i=>i*l):[];if(t.cap!=="butt")for(const[i,a]of e.entries())e[i]=i%2==1?a+l:Math.max(a-l,1);return e}const G=(()=>{const t={};return o=>{if(t[o])return t[o];const r=o.replaceAll("-","");return t[o]=r,r}})(),dt=new u([128,128,128]),J=new u("white");function bt(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(o=>o.type==="object");case"line-3d":return t.symbolLayers.some(o=>o.type==="path");case"polygon-3d":return t.symbolLayers.some(o=>o.type==="object"||o.type==="extrude");default:return!1}}function wt(t){var o;return((o=t.resource)==null?void 0:o.href)??""}function gt(t,o){if(!t)return null;let r=null;return y(t)?r=W(t):p(t)&&(r=t.type==="cim"?k(t):t.color?new u(t.color):null),r?h(r,o):null}function W(t){const o=t.symbolLayers;if(!o)return null;let r=null;return o.forEach(n=>{var l;n.type==="object"&&((l=n.resource)!=null&&l.href)||(r=n.type==="water"?n.color:n.material?n.material.color:null)}),r?new u(r):null}function h(t,o){if(o==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*o,new u(r)}function q(t,o,r){const n=t.symbolLayers;if(!n)return;const l=e=>h(o=o??e??(r!=null?J:null),r);n.forEach(e=>{var i,a;if(e.type!=="object"||!((i=e.resource)!=null&&i.href)||o)if(e.type==="water")e.color=l(e.color);else{const s=e.material!=null?e.material.color:null,c=l(s);e.material==null?e.material=new I({color:c}):e.material.color=c,r!=null&&"outline"in e&&((a=e.outline)==null?void 0:a.color)!=null&&(e.outline.color=h(e.outline.color,r))}})}function B(t,o,r){var n;(o=o??t.color)&&(t.color=h(o,r)),r!=null&&"outline"in t&&((n=t.outline)!=null&&n.color)&&(t.outline.color=h(t.outline.color,r))}function kt(t,o,r){t&&(o||r!=null)&&(o&&(o=new u(o)),y(t)?q(t,o,r):p(t)&&B(t,o,r))}async function K(t,o){const r=t.symbolLayers;r&&await v(r,async n=>Q(n,o))}async function Q(t,o){switch(t.type){case"extrude":Y(t,o);break;case"icon":case"line":case"text":X(t,o);break;case"path":tt(t,o);break;case"object":await Z(t,o)}}function X(t,o){const r=L(o);r!=null&&(t.size=r)}function L(t){for(const o of t)if(typeof o=="number")return o;return null}function Y(t,o){t.size=typeof o[2]=="number"?o[2]:0}async function Z(t,o){const{resourceSize:r,symbolSize:n}=await ot(t),l=M(o,r,n);t.width=m(o[0],n[0],r[0],l),t.depth=m(o[1],n[1],r[1],l),t.height=m(o[2],n[2],r[2],l)}function tt(t,o){const r=M(o,z,[t.width,void 0,t.height]);t.width=m(o[0],t.width,1,r),t.height=m(o[2],t.height,1,r)}function M(t,o,r){for(let n=0;n<3;n++){const l=t[n];switch(l){case"symbol-value":{const e=r[n];return e!=null?e/o[n]:1}case"proportional":break;default:if(l&&o[n])return l/o[n]}}return 1}async function ot(t){const{computeObjectLayerResourceSize:o}=await j(()=>import("./symbolLayerUtils-3c267034.js"),["./symbolLayerUtils-3c267034.js","./request-a10d6950.js","./Error-21d1d076.js","./typedArrayUtil-2af43698.js","./JSONSupport-acf2865c.js","./subclass-f7409b1b.js","./promiseUtils-1d963c7c.js","./time-0817624a.js","./LRUCache-000d0e19.js","./mathUtils-19b6edfc.js","./aaBoundingBox-7242ce3e.js","./Extent-2b4578b8.js","./SpatialReference-428523ee.js","./jsonMap-5ba4a9c2.js","./assets-6fd92e57.js","./cast-e7a2f9aa.js","./symbolLayerUtils3D-5b91ffd6.js"],import.meta.url),r=await o(t,10),{width:n,height:l,depth:e}=t,i=[n,e,l];let a=1;for(let s=0;s<3;s++){const c=i[s];if(c!=null){a=c/r[s];break}}for(let s=0;s<3;s++)i[s]==null&&(i[s]=r[s]*a);return{resourceSize:r,symbolSize:i}}function m(t,o,r,n){switch(t){case"proportional":return r*n;case"symbol-value":return o??r;default:return t}}function rt(t,o){const r=L(o);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const n=t.width/t.height;n>1?(t.width=r,t.height=r*n):(t.width=r*n,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function $t(t,o){if(t&&o)return y(t)?K(t,o):void(p(t)&&rt(t,o))}function St(t,o,r){if(t&&o!=null)if(y(t)){const n=t.symbolLayers;n&&n.forEach(l=>{if(l&&l.type==="object")switch(r){case"tilt":l.tilt=(l.tilt??0)+o;break;case"roll":l.roll=(l.roll??0)+o;break;default:l.heading=(l.heading??0)+o}})}else p(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=o))}function xt(t){if(!t)return null;const o=t.effects.filter(r=>r.type!=="bloom").map(r=>r.toJSON());return P(o)}async function Lt(t,o){return await t.fetchSymbol(o)||t.fetchCIMSymbol(o)}export{St as D,xt as I,Lt as N,$t as R,kt as a,dt as b,H as c,pt as f,V as g,gt as h,wt as p,yt as u,G as w,bt as y};
