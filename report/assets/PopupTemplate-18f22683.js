import{e,c as l,T as G,S as Dt}from"./subclass-f7409b1b.js";import{i as Nt}from"./Clonable-b71fa929.js";import{V as it}from"./Collection-aa6ef54b.js";import{y as o,f as h,S as Tt}from"./JSONSupport-acf2865c.js";import{b as w,s as Vt}from"./Error-21d1d076.js";import{S as zt}from"./promiseUtils-1d963c7c.js";import{s as Wt}from"./cast-e7a2f9aa.js";import{o as Ct}from"./Extent-2b4578b8.js";import{r as T}from"./SpatialReference-428523ee.js";import{b as qt,h as Gt}from"./fieldUtils-fcb2a714.js";import"./typedArrayUtil-2af43698.js";import{s as Kt,o as Ht}from"./jsonMap-5ba4a9c2.js";import{o as At}from"./enumeration-4a4e87c4.js";import{Y as Yt}from"./date-7940da18.js";import{u as Qt}from"./Color-e1a6dfab.js";import{s as Xt}from"./Identifiable-1430bdc2.js";let P=class extends h{constructor(i){super(i),this.type=null}};e([o({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],P.prototype,"type",void 0),P=e([l("esri.popup.content.Content")],P);const I=P;var ot;let $=ot=class extends I{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new ot({description:this.description,displayType:this.displayType,title:this.title})}};e([o({type:String,json:{write:!0}})],$.prototype,"description",void 0),e([o({type:["auto","preview","list"],json:{write:!0}})],$.prototype,"displayType",void 0),e([o({type:String,json:{write:!0}})],$.prototype,"title",void 0),e([o({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],$.prototype,"type",void 0),$=ot=e([l("esri.popup.content.AttachmentsContent")],$);const K=$;var st;let F=st=class extends I{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new st({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?w(this.outFields):null})}};e([o()],F.prototype,"creator",void 0),e([o()],F.prototype,"destroyer",void 0),e([o()],F.prototype,"outFields",void 0),e([o({type:["custom"],readOnly:!0})],F.prototype,"type",void 0),F=st=e([l("esri.popup.content.CustomContent")],F);const Zt=F;var rt;let O=rt=class extends h{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new rt({title:this.title,expression:this.expression})}};e([o({type:String,json:{write:!0}})],O.prototype,"title",void 0),e([o({type:String,json:{write:!0}})],O.prototype,"expression",void 0),e([o({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],O.prototype,"returnType",void 0),O=rt=e([l("esri.popup.ElementExpressionInfo")],O);const te=O;var nt;let A=nt=class extends I{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new nt({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};e([o({type:te,json:{write:!0}})],A.prototype,"expressionInfo",void 0),e([o({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],A.prototype,"type",void 0),A=nt=e([l("esri.popup.content.ExpressionContent")],A);const St=A;let _=class extends Nt(h){constructor(i){super(i),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};e([At(Yt)],_.prototype,"dateFormat",void 0),e([o({type:Boolean,json:{write:!0}})],_.prototype,"digitSeparator",void 0),e([o({type:G,json:{write:!0}})],_.prototype,"places",void 0),_=e([l("esri.popup.support.FieldInfoFormat")],_);const ee=_;var lt;let u=lt=class extends h{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new lt({fieldName:this.fieldName,format:this.format?w(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};e([o({type:String,json:{write:!0}})],u.prototype,"fieldName",void 0),e([o({type:ee,json:{write:!0}})],u.prototype,"format",void 0),e([o({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],u.prototype,"isEditable",void 0),e([o({type:String,json:{write:!0}})],u.prototype,"label",void 0),e([At(new Kt({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],u.prototype,"stringFieldOption",void 0),e([o({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],u.prototype,"statisticType",void 0),e([o({type:String,json:{write:!0}})],u.prototype,"tooltip",void 0),e([o({type:Boolean,json:{write:!0}})],u.prototype,"visible",void 0),u=lt=e([l("esri.popup.FieldInfo")],u);const Et=u;var pt;let v=pt=class extends I{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,i){i.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new pt(w({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};e([o({type:Object,json:{write:!0}})],v.prototype,"attributes",void 0),e([o({type:String,json:{write:!0}})],v.prototype,"description",void 0),e([o({type:[Et]})],v.prototype,"fieldInfos",void 0),e([T("fieldInfos")],v.prototype,"writeFieldInfos",null),e([o({type:String,json:{write:!0}})],v.prototype,"title",void 0),e([o({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],v.prototype,"type",void 0),v=pt=e([l("esri.popup.content.FieldsContent")],v);const H=v;let b=class extends h{constructor(i){super(i),this.altText=null,this.caption="",this.title="",this.type=null}};e([o({type:String,json:{write:!0}})],b.prototype,"altText",void 0),e([o({type:String,json:{write:!0}})],b.prototype,"caption",void 0),e([o({type:String,json:{write:!0}})],b.prototype,"title",void 0),e([o({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],b.prototype,"type",void 0),b=e([l("esri.popup.content.mixins.MediaInfo")],b);const Ot=b;var at;let j=at=class extends Tt{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new at({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};e([o()],j.prototype,"color",void 0),e([o()],j.prototype,"fieldName",void 0),e([o()],j.prototype,"tooltip",void 0),e([o()],j.prototype,"value",void 0),j=at=e([l("esri.popup.content.support.ChartMediaInfoValueSeries")],j);const ie=j;var dt;let x=dt=class extends h{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new dt({colors:w(this.colors),fields:w(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};e([o({type:[Qt],json:{type:[[G]],write:!0}})],x.prototype,"colors",void 0),e([o({type:[String],json:{write:!0}})],x.prototype,"fields",void 0),e([o({type:String,json:{write:!0}})],x.prototype,"normalizeField",void 0),e([o({type:[ie],json:{read:!1}})],x.prototype,"series",void 0),e([o({type:String,json:{write:!0}})],x.prototype,"tooltipField",void 0),x=dt=e([l("esri.popup.content.support.ChartMediaInfoValue")],x);const oe=x;let E=class extends Ot{constructor(i){super(i),this.type=null,this.value=null}};e([o({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],E.prototype,"type",void 0),e([o({type:oe,json:{write:!0}})],E.prototype,"value",void 0),E=e([l("esri.popup.content.mixins.ChartMediaInfo")],E);const Z=E,tt=Ht()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var ct;let D=ct=class extends Z{constructor(t){super(t),this.type="bar-chart"}clone(){return new ct({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};e([o({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:tt.write}})],D.prototype,"type",void 0),D=ct=e([l("esri.popup.content.BarChartMediaInfo")],D);const Mt=D;var ht;let V=ht=class extends Z{constructor(t){super(t),this.type="column-chart"}clone(){return new ht({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};e([o({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:tt.write}})],V.prototype,"type",void 0),V=ht=e([l("esri.popup.content.ColumnChartMediaInfo")],V);const Bt=V;var ut;let M=ut=class extends h{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new ut({linkURL:this.linkURL,sourceURL:this.sourceURL})}};e([o({type:String,json:{write:!0}})],M.prototype,"linkURL",void 0),e([o({type:String,json:{write:!0}})],M.prototype,"sourceURL",void 0),M=ut=e([l("esri.popup.content.support.ImageMediaInfoValue")],M);const se=M;var yt;let R=yt=class extends Ot{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new yt({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};e([o({type:Number,json:{write:!0}})],R.prototype,"refreshInterval",void 0),e([o({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],R.prototype,"type",void 0),e([o({type:se,json:{write:!0}})],R.prototype,"value",void 0),R=yt=e([l("esri.popup.content.ImageMediaInfo")],R);const Jt=R;var ft;let z=ft=class extends Z{constructor(t){super(t),this.type="line-chart"}clone(){return new ft({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};e([o({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:tt.write}})],z.prototype,"type",void 0),z=ft=e([l("esri.popup.content.LineChartMediaInfo")],z);const Lt=z;var mt;let W=mt=class extends Z{constructor(t){super(t),this.type="pie-chart"}clone(){return new mt({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};e([o({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:tt.write}})],W.prototype,"type",void 0),W=mt=e([l("esri.popup.content.PieChartMediaInfo")],W);const Ut=W,kt={base:Ot,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Mt,"column-chart":Bt,"line-chart":Lt,"pie-chart":Ut,image:Jt}};var vt;let y=vt=class extends I{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(i=>i.type==="image"?Jt.fromJSON(i):i.type==="barchart"?Mt.fromJSON(i):i.type==="columnchart"?Bt.fromJSON(i):i.type==="linechart"?Lt.fromJSON(i):i.type==="piechart"?Ut.fromJSON(i):void 0).filter(Boolean)}writeMediaInfos(t,i){i.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new vt(w({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};e([o()],y.prototype,"activeMediaInfoIndex",void 0),e([o({type:Object,json:{write:!0}})],y.prototype,"attributes",void 0),e([o({type:String,json:{write:!0}})],y.prototype,"description",void 0),e([o({types:[kt]})],y.prototype,"mediaInfos",void 0),e([Ct("mediaInfos")],y.prototype,"readMediaInfos",null),e([T("mediaInfos")],y.prototype,"writeMediaInfos",null),e([o({type:String,json:{write:!0}})],y.prototype,"title",void 0),e([o({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],y.prototype,"type",void 0),y=vt=e([l("esri.popup.content.MediaContent")],y);const Y=y;var wt;let B=wt=class extends h{constructor(t){super(t),this.field=null,this.order=null}clone(){return new wt({field:this.field,order:this.order})}};e([o({type:String,json:{write:!0}})],B.prototype,"field",void 0),e([o({type:["asc","desc"],json:{write:!0}})],B.prototype,"order",void 0),B=wt=e([l("esri.popup.support.RelatedRecordsInfoFieldOrder")],B);const Pt=B;let m=class extends Nt(I){constructor(t){super(t),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};e([o({type:String,json:{write:!0}})],m.prototype,"description",void 0),e([o({type:Number,json:{type:G,write:!0}})],m.prototype,"displayCount",void 0),e([o({type:["list"],json:{write:!0}})],m.prototype,"displayType",void 0),e([o({type:[Pt],json:{write:!0}})],m.prototype,"orderByFields",void 0),e([o({type:Number,json:{type:G,write:!0}})],m.prototype,"relationshipId",void 0),e([o({type:String,json:{write:!0}})],m.prototype,"title",void 0),e([o({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],m.prototype,"type",void 0),m=e([l("esri.popup.content.RelationshipContent")],m);const Q=m;var xt;let J=xt=class extends I{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new xt({text:this.text})}};e([o({type:String,json:{write:!0}})],J.prototype,"text",void 0),e([o({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],J.prototype,"type",void 0),J=xt=e([l("esri.popup.content.TextContent")],J);const X=J,re={base:null,key:"type",typeMap:{attachment:K,media:Y,text:X,expression:St,field:H,relationship:Q}};var It;let N=It=class extends h{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new It({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};e([o({type:String,json:{write:!0}})],N.prototype,"name",void 0),e([o({type:String,json:{write:!0}})],N.prototype,"title",void 0),e([o({type:String,json:{write:!0}})],N.prototype,"expression",void 0),e([o({type:["string","number"],json:{write:!0}})],N.prototype,"returnType",void 0),N=It=e([l("esri.popup.ExpressionInfo")],N);const ne=N;var gt;let L=gt=class extends h{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new gt({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};e([o({type:Boolean,json:{write:!0}})],L.prototype,"returnTopmostRaster",void 0),e([o({type:Boolean,json:{write:!0}})],L.prototype,"showNoDataRecords",void 0),L=gt=e([l("esri.popup.LayerOptions")],L);const le=L;var $t;let U=$t=class extends h{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new $t({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?w(this.orderByFields):null})}};e([o({type:Boolean,json:{write:!0}})],U.prototype,"showRelatedRecords",void 0),e([o({type:[Pt],json:{write:!0}})],U.prototype,"orderByFields",void 0),U=$t=e([l("esri.popup.RelatedRecordsInfo")],U);const pe=U;var Ft;let c=Ft=class extends Xt(Tt){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new Ft({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};e([o()],c.prototype,"active",void 0),e([o()],c.prototype,"className",void 0),e([o()],c.prototype,"disabled",void 0),e([o()],c.prototype,"icon",void 0),e([o()],c.prototype,"id",void 0),e([o()],c.prototype,"indicator",void 0),e([o()],c.prototype,"title",void 0),e([o()],c.prototype,"type",void 0),e([o()],c.prototype,"visible",void 0),c=Ft=e([l("esri.support.actions.ActionBase")],c);const _t=c;var bt;let q=bt=class extends _t{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new bt({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};e([o()],q.prototype,"image",void 0),q=bt=e([l("esri.support.Action.ActionButton")],q);const ae=q;var jt;let k=jt=class extends _t{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new jt({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};e([o()],k.prototype,"image",void 0),e([o()],k.prototype,"value",void 0),k=jt=e([l("esri.support.Action.ActionToggle")],k);const de=k,C="relationships/",Rt="expression/",ce=it.ofType({key:"type",defaultKeyValue:"button",base:_t,typeMap:{button:ae,toggle:de}}),he={base:I,key:"type",typeMap:{media:Y,custom:Zt,text:X,attachments:K,fields:H,expression:St,relationship:Q}},ue=new Set(["attachments","fields","media","text","expression","relationship"]);let a=class extends Nt(h){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(t){return Array.isArray(t)?t.map(i=>Dt(he,i)):typeof t=="string"||typeof t=="function"||t instanceof HTMLElement||zt(t)?t:(Vt.getLogger(this).error("content error","unsupported content value",{value:t}),null)}readContent(t,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeContent(t,i,r,n){typeof t!="string"?Array.isArray(t)&&(i.popupElements=t.filter(s=>ue.has(s.type)).map(s=>s==null?void 0:s.toJSON(n)),i.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(i):s.type==="media"?this._writeMediaContent(s,i):s.type==="text"?this._writeTextContent(s,i):s.type==="relationship"&&this._writeRelationshipContent(s,i)})):i.description=t}writeFieldInfos(t,i,r,n){const{content:s}=this,p=Array.isArray(s)?s:null;if(t){const d=p?p.filter(f=>f.type==="fields"):[],S=d.length&&d.every(f=>{var g;return(g=f.fieldInfos)==null?void 0:g.length});i.fieldInfos=t.filter(Boolean).map(f=>{const g=f.toJSON(n);return S&&(g.visible=!1),g})}if(p)for(const d of p)d.type==="fields"&&this._writeFieldsContent(d,i)}writeLayerOptions(t,i,r,n){i[r]=!t||t.showNoDataRecords===null&&t.returnTopmostRaster===null?null:t.toJSON(n)}writeTitle(t,i){i.title=t||""}async collectRequiredFields(t,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(t,i,[...r,...this._getContentExpressionInfos(this.content,r)]),qt(t,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(t){const i=new Set;return await this.collectRequiredFields(i,t),[...i].sort()}_writeFieldsContent(t,i){if(!Array.isArray(t.fieldInfos)||!t.fieldInfos.length)return;const r=w(t.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(n=>{const s=i.fieldInfos.find(p=>p.fieldName.toLowerCase()===n.fieldName.toLowerCase());s?s.visible=!0:i.fieldInfos.push(n)}):i.fieldInfos=r}_writeAttachmentContent(t){t.showAttachments||(t.showAttachments=!0)}_writeRelationshipContent(t,i){var s,p;const r=((s=t.orderByFields)==null?void 0:s.map(d=>this._toFieldOrderJSON(d,t.relationshipId)))||[],n=[...((p=i.relatedRecordsInfo)==null?void 0:p.orderByFields)||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...(n==null?void 0:n.length)&&{orderByFields:n}}}_writeTextContent(t,i){!i.description&&t.text&&(i.description=t.text)}_writeMediaContent(t,i){if(!Array.isArray(t.mediaInfos)||!t.mediaInfos.length)return;const r=w(t.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(t,i,r){const n={description:!1,mediaInfos:!1};return r.map(s=>s.type==="media"?(s.mediaInfos||!i||n.mediaInfos||(s.mediaInfos=i,n.mediaInfos=!0),Y.fromJSON(s)):s.type==="text"?(s.text||!t||n.description||(s.text=t,n.description=!0),X.fromJSON(s)):s.type==="attachments"?K.fromJSON(s):s.type==="fields"?H.fromJSON(s):s.type==="expression"?St.fromJSON(s):s.type==="relationship"?Q.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(t){const{field:i,order:r}=t;if(!(i!=null&&i.startsWith(C)))return null;const n=i.replace(C,"").split("/");if(n.length!==2)return null;const s=parseInt(n[0],10),p=n[1];return typeof s=="number"&&p?Q.fromJSON({relationshipId:s,orderByFields:[{field:p,order:r}]}):null}_toFieldOrderJSON(t,i){const{order:r,field:n}=t;return{field:`${C}${i}/${n}`,order:r}}_readPopupInfo({description:t,mediaInfos:i,showAttachments:r,relatedRecordsInfo:n={showRelatedRecords:!1}}){const s=[];t?s.push(new X({text:t})):s.push(new H),Array.isArray(i)&&i.length&&s.push(Y.fromJSON({mediaInfos:i})),r&&s.push(K.fromJSON({displayType:"auto"}));const{showRelatedRecords:p,orderByFields:d}=n;return p&&(d!=null&&d.length)&&d.forEach(S=>{const f=this._toRelationshipContent(S);f&&s.push(f)}),s.length?s:t}_getContentElementFields(t){const i=t==null?void 0:t.type;if(i==="attachments")return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description)];if(i==="custom")return t.outFields||[];if(i==="fields")return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description),...this._getFieldInfoFields(t.fieldInfos??this.fieldInfos)];if(i==="media"){const r=t.mediaInfos||[];return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description),...r.reduce((n,s)=>[...n,...this._getMediaInfoFields(s)],[])]}return i==="text"?this._extractFieldNames(t.text):[]}_getMediaInfoFields(t){const{caption:i,title:r,value:n}=t,s=n||{},{fields:p,normalizeField:d,tooltipField:S,sourceURL:f,linkURL:g}=s,et=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(f),...this._extractFieldNames(g),...p??[]];return d&&et.push(d),S&&et.push(S),et}_getContentExpressionInfos(t,i){return Array.isArray(t)?t.reduce((r,n)=>[...r,...n.type==="expression"&&n.expressionInfo?[n.expressionInfo]:[]],i):[]}_getContentFields(t){return typeof t=="string"?this._extractFieldNames(t):Array.isArray(t)?t.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(t,i,r){r&&await Promise.all(r.map(n=>Gt(t,i,n.expression)))}_getFieldInfoFields(t){return t?t.filter(i=>i.visible===void 0||!!i.visible).map(i=>i.fieldName).filter(i=>!i.startsWith(C)&&!i.startsWith(Rt)):[]}_getActionsFields(t){return t?t.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(t){const{className:i,title:r,type:n}=t,s=n==="button"||n==="toggle"?t.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(s)]}_getTitleFields(t){return typeof t=="string"?this._extractFieldNames(t):[]}_extractFieldNames(t){if(!t||typeof t!="string")return[];const i=/{[^}]*}/g,r=t.match(i);if(!r)return[];const n=/\{(\w+):.+\}/,s=r.filter(p=>!(p.indexOf(`{${C}`)===0||p.indexOf(`{${Rt}`)===0)).map(p=>p.replace(n,"{$1}"));return s?s.map(p=>p.slice(1,-1)):[]}};e([o({type:ce})],a.prototype,"actions",void 0),e([o()],a.prototype,"content",void 0),e([Wt("content")],a.prototype,"castContent",null),e([Ct("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],a.prototype,"readContent",null),e([T("content",{popupElements:{type:it.ofType(re)},showAttachments:{type:Boolean},mediaInfos:{type:it.ofType(kt)},description:{type:String},relatedRecordsInfo:{type:pe}})],a.prototype,"writeContent",null),e([o({type:[ne],json:{write:!0}})],a.prototype,"expressionInfos",void 0),e([o({type:[Et]})],a.prototype,"fieldInfos",void 0),e([T("fieldInfos")],a.prototype,"writeFieldInfos",null),e([o({type:le})],a.prototype,"layerOptions",void 0),e([T("layerOptions")],a.prototype,"writeLayerOptions",null),e([o({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],a.prototype,"lastEditInfoEnabled",void 0),e([o()],a.prototype,"outFields",void 0),e([o()],a.prototype,"overwriteActions",void 0),e([o()],a.prototype,"returnGeometry",void 0),e([o({json:{type:String}})],a.prototype,"title",void 0),e([T("title")],a.prototype,"writeTitle",null),a=e([l("esri.PopupTemplate")],a);const Ee=a;export{Y as I,Ee as P,ee as a,K as b,H as c,ne as d,ie as e,te as f,X as g,ae as h,Pt as i,de as j,Et as m,_t as p};
