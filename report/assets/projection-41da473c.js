import{_ as Z}from"./request-a10d6950.js";import{a as tn}from"./Error-21d1d076.js";import{D as b,s as en}from"./promiseUtils-1d963c7c.js";import{f as K}from"./subclass-f7409b1b.js";import{s as sn}from"./SimpleObservable-ae589a25.js";import{n as N}from"./mathUtils-19b6edfc.js";import{d as C,f as T,G as A,N as y,O as R,_ as on,e as rn,a as ln}from"./SpatialReference-428523ee.js";import{x as un,M as an}from"./Extent-2b4578b8.js";import{j as cn,m as fn,u as pn}from"./Polyline-013cde1f.js";import{n as $,W as hn,S as mn,G as dn}from"./projectBuffer-af7b4ad9.js";import{o as gn}from"./zscale-d7e12601.js";function D(e,t,n,i,s,o){return G[0]=e,G[1]=t,G[2]=n,$(G,i,0,s,o,0,1)}const G=N();let E=0;class k{static fromGE(t){const n=new k;return n._wkt=t.wkt,n._wkid=t.wkid,n._isInverse=t.isInverse,n}constructor(t){this.uid=E++,t?(this._wkt=t.wkt!=null?t.wkt:null,this._wkid=t.wkid!=null?t.wkid:-1,this._isInverse=t.isInverse!=null&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=E++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=E++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=E++}getInverse(){const t=new k;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class d{static cacheKey(t,n){var i,s,o,r,l,u;return[((i=t.wkid)==null?void 0:i.toString())??"-1",((s=t.wkt)==null?void 0:s.toString())??"",((o=t.wkt2)==null?void 0:o.toString())??"",((r=n.wkid)==null?void 0:r.toString())??"-1",((l=n.wkt)==null?void 0:l.toString())??"",((u=n.wkt2)==null?void 0:u.toString())??""].join()}static fromGE(t){const n=new d;let i="";for(const s of t.steps){const o=k.fromGE(s);n.steps.push(o),i+=o.uid.toString()+","}return n._cachedProjection={},n._gtlistentry=null,n._chain=i,n}constructor(t){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,t==null?void 0:t.steps)for(const n of t.steps)n instanceof k?this.steps.push(n):this.steps.push(new k({wkid:n.wkid,wkt:n.wkt,isInverse:n.isInverse}))}getInverse(){const t=new d;t.steps=[];for(let n=this.steps.length-1;n>=0;n--){const i=this.steps[n];t.steps.push(i.getInverse())}return t}getGTListEntry(){let t="";for(const n of this.steps)t+=n.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=t),this._gtlistentry}assignCachedGe(t,n,i){this._cachedProjection[d.cacheKey(t,n)]=i}getCachedGeTransformation(t,n){let i="";for(const o of this.steps)i+=o.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const s=this._cachedProjection[d.cacheKey(t,n)];return s===void 0?null:s}}let m=null,g=null,j=null,L={};const W=new sn;function I(){return!!m&&ln()}function V(){return!!I()||(K(W),v(),!1)}function wn(e,t){return!e||!t||w(e,t)||V()}function _n(e,t){return!w(e,t)&&!I()}function v(e){return j==null&&(j=Promise.all([on(),Z(()=>import("./geometryEngineBase-77e94ca5.js"),["./geometryEngineBase-77e94ca5.js","./_commonjsHelpers-2f3e7994.js"],import.meta.url).then(t=>t.g),Z(()=>import("./hydrated-1443544c.js"),["./hydrated-1443544c.js","./Extent-2b4578b8.js","./subclass-f7409b1b.js","./typedArrayUtil-2af43698.js","./Error-21d1d076.js","./promiseUtils-1d963c7c.js","./JSONSupport-acf2865c.js","./time-0817624a.js","./SpatialReference-428523ee.js","./jsonMap-5ba4a9c2.js","./request-a10d6950.js","./assets-6fd92e57.js","./cast-e7a2f9aa.js","./Polyline-013cde1f.js","./aaBoundingRect-aef00841.js","./Axis-30be7e73.js","./mathUtils-19b6edfc.js"],import.meta.url)])),j.then(([,t,{hydratedAdapter:n}])=>{en(e),g=n,m=t.default,m._enableProjection(rn),W.notify()})}function q(e,t,n=null,i=null){return Array.isArray(e)?e.length===0?[]:O(g,e,e[0].spatialReference,t,n,i):O(g,[e],e.spatialReference,t,n,i)[0]}function O(e,t,n,i,s=null,o=null){if(n==null||i==null)return t;if(w(n,i,s))return t.map(r=>M(r,n,i));if(s==null&&C(n))return t.map(r=>M(r,n,T.WGS84)).map(r=>x(r,i));if(s==null&&C(i))return t.map(r=>x(r,T.WGS84)).map(r=>M(r,T.WGS84,i));if(s==null){const r=d.cacheKey(n,i);L[r]!==void 0?s=L[r]:((s=F(n,i,void 0))==null&&(s=new d),L[r]=s)}if(m==null||e==null)throw new z;return o!=null?m._project(e,t,n,i,s,o):m._project(e,t,n,i,s)}function yn(e,t){const n=B([e],t);return n.pending!=null?{pending:n.pending,geometry:null}:n.geometries!=null?{pending:null,geometry:n.geometries[0]}:{pending:null,geometry:null}}function B(e,t){if(!I()){for(const n of e)if(n!=null&&!A(n.spatialReference,t)&&y(n.spatialReference)&&y(t)&&!w(n.spatialReference,t))return K(W),{pending:v(),geometries:null}}return{pending:null,geometries:e.map(n=>n==null?null:A(n.spatialReference,t)?n:y(n.spatialReference)&&y(t)?x(n,t):null)}}function F(e,t,n=null){if(e==null||t==null)return null;if(m==null||g==null)throw new z;const i=m._getTransformation(g,e,t,n,n==null?void 0:n.spatialReference);return i!==null?d.fromGE(i):null}function kn(e,t,n=null){if(m==null||g==null)throw new z;const i=m._getTransformationBySuitability(g,e,t,n,n==null?void 0:n.spatialReference);if(i!==null){const s=[];for(const o of i)s.push(d.fromGE(o));return s}return[]}class z extends tn{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}function Rn(){m=null,g=null,j=null,L={}}const jn={get loadPromise(){return j}};function x(e,t){try{const n=q(e,t);if(n==null)return null;"xmin"in e&&"xmin"in n&&(n.zmin=e.zmin,n.zmax=e.zmax);const i=gn(n.type,e.spatialReference,t);return i!=null&&i(n),n}catch(n){if(!(n instanceof z))throw n;return null}}async function vn(e,t,n){const i=e.spatialReference;return i!=null&&t!=null&&await H(i,t,null,n),x(e,t)}function w(e,t,n){return!n&&(!!A(e,t)||y(e)&&y(t)&&!!hn(e,t,mn))}async function H(e,t,n,i){if(I())return b(i);if(Array.isArray(e)){for(const{source:s,dest:o,geographicTransformation:r}of e)if(s&&o&&!w(s,o,r))return v(i)}else if(e&&t&&!w(e,t,n))return v(i);return b(i)}function M(e,t,n){return e?"x"in e?J(e,t,new un,n,0):"xmin"in e?Y(e,t,new an,n,0):"rings"in e?X(e,t,new cn,n,0):"paths"in e?U(e,t,new fn,n,0):"points"in e?Q(e,t,new pn,n,0):null:null}function xn(e,t,n=t.spatialReference,i=0){return n!=null&&e.spatialReference!=null&&J(e,e.spatialReference,t,n,i)!=null}function J(e,t,n,i,s){a[0]=e.x,a[1]=e.y;const o=e.z;return a[2]=o!==void 0?o:s,$(a,t,0,a,i,0,1)?(n.x=a[0],n.y=a[1],n.spatialReference=i,o!==void 0||R(i)?(n.z=a[2],n.hasZ=!0):(n.z=void 0,n.hasZ=!1),e.m===void 0?(n.m=void 0,n.hasM=!1):(n.m=e.m,n.hasM=!0),n):null}function In(e,t,n=t.spatialReference,i=0){return e.spatialReference!=null&&n!=null&&Q(e,e.spatialReference,t,n,i)!=null}function Q(e,t,n,i,s){const{points:o,hasZ:r,hasM:l}=e,u=[],p=o.length,h=[];for(const c of o)h.push(c[0],c[1],r?c[2]:s);if(!$(h,t,0,h,i,0,p))return null;const f=r||R(i);for(let c=0;c<p;++c){const _=3*c,P=h[_],S=h[_+1];f&&l?u.push([P,S,h[_+2],o[c][3]]):f?u.push([P,S,h[_+2]]):l?u.push([P,S,o[c][2]]):u.push([P,S])}return n.points=u,n.spatialReference=i,n.hasZ=r,n.hasM=l,n}function Pn(e,t,n=t.spatialReference,i=0){return e.spatialReference!=null&&n!=null&&U(e,e.spatialReference,t,n,i)!=null}function U(e,t,n,i,s){const{paths:o,hasZ:r,hasM:l}=e,u=[];if(!nn(o,r??!1,l??!1,t,u,i,s))return null;const p=r||R(i);return n.paths=u,n.spatialReference=i,n.hasZ=p,n.hasM=l,n}function Sn(e,t,n=t.spatialReference,i=0){return e.spatialReference!=null&&n!=null&&X(e,e.spatialReference,t,n,i)!=null}function X(e,t,n,i,s){const{rings:o,hasZ:r,hasM:l}=e,u=[];if(!nn(o,r??!1,l??!1,t,u,i,s))return null;const p=r||R(i);return n.rings=u,n.spatialReference=i,n.hasZ=p,n.hasM=l,n}function Gn(e,t,n=t.spatialReference,i=0){return e.spatialReference!=null&&n!=null&&Y(e,e.spatialReference,t,n,i)!=null}function Y(e,t,n,i,s){const{xmin:o,ymin:r,xmax:l,ymax:u,hasZ:p,hasM:h}=e,f=p?e.zmin:s;if(!D(o,r,f,t,a,i))return null;const c=p||R(i);n.xmin=a[0],n.ymin=a[1],c&&(n.zmin=a[2]);const _=p?e.zmax:s;return D(l,u,_,t,a,i)?(n.xmax=a[0],n.ymax=a[1],c&&(n.zmax=a[2]),h&&(n.mmin=e.mmin,n.mmax=e.mmax),n.spatialReference=i,n):null}function nn(e,t,n,i,s,o,r=0){const l=new Array;for(const h of e)for(const f of h)l.push(f[0],f[1],t?f[2]:r);if(!$(l,i,0,l,o,0,l.length/3))return!1;let u=0;s.length=0;const p=t||R(o);for(const h of e){const f=new Array;for(const c of h)p&&n?f.push([l[u++],l[u++],l[u++],c[3]]):p?f.push([l[u++],l[u++],l[u++]]):n?(f.push([l[u++],l[u++],c[2]]),u++):(f.push([l[u++],l[u++]]),u++);s.push(f)}return!0}function En(e){return e!=null&&dn(e)!=null}const a=N(),Dn=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:En,canProjectWithoutEngine:w,getTransformation:F,getTransformations:kn,initializeProjection:H,isLoaded:I,isLoadedOrLoad:V,isLoadedOrLoadFor:wn,load:v,project:q,projectExtent:Gn,projectMany:O,projectMultipoint:In,projectOrLoad:yn,projectOrLoadMany:B,projectPoint:xn,projectPolygon:Sn,projectPolyline:Pn,projectWithZConversion:vn,projectWithoutEngine:M,requiresLoad:_n,test:jn,tryProjectWithZConversion:x,unload:Rn},Symbol.toStringTag,{value:"Module"}));export{v as B,x as D,I as E,w as H,H as I,M as J,yn as K,B as O,q as U,F as V,O as W,wn as _,Dn as p,Sn as r,d as s};
