import{u as E}from"./Color-e1a6dfab.js";import{H as D}from"./colorUtils-f660fd36.js";import{a as H}from"./Error-21d1d076.js";import{c as U}from"./fontUtils-d07df119.js";import{u as w}from"./screenUtils-7afeb41c.js";import{u as T,c as O,g as V,f as W}from"./utils-68ee32f9.js";import{t as S,f as I,g as F,h as G}from"./index-6dc76aa4.js";import{s as L}from"./TextSymbol-53669eb2.js";import"./colorUtils-ac6863dc.js";import"./mathUtils-19b6edfc.js";import"./subclass-f7409b1b.js";import"./typedArrayUtil-2af43698.js";import"./promiseUtils-1d963c7c.js";import"./vec42-a95eff2d.js";import"./vec4f64-430e4feb.js";import"./request-a10d6950.js";import"./JSONSupport-acf2865c.js";import"./time-0817624a.js";import"./symbols-b3e075ad.js";import"./enumeration-4a4e87c4.js";import"./jsonMap-5ba4a9c2.js";import"./Extent-2b4578b8.js";import"./SpatialReference-428523ee.js";import"./assets-6fd92e57.js";import"./cast-e7a2f9aa.js";import"./fieldUtils-fcb2a714.js";import"./intl-fe039018.js";import"./date-7940da18.js";import"./locale-bde6d0f6.js";import"./datetime-7e00d9ef.js";import"./messages-2d262041.js";import"./geometry-31b45acd.js";import"./Polyline-013cde1f.js";import"./aaBoundingRect-aef00841.js";import"./Axis-30be7e73.js";import"./typeUtils-3056a943.js";import"./opacityUtils-f0a081b4.js";import"./symbolLayerUtils3D-5b91ffd6.js";import"./aaBoundingBox-7242ce3e.js";import"./persistableUrlUtils-ca6bb38d.js";import"./Collection-aa6ef54b.js";import"./Evented-b5127116.js";import"./SimpleObservable-ae589a25.js";import"./collectionUtils-b6e30316.js";import"./Portal-cb507469.js";import"./Loadable-8a1ead8b.js";import"./Promise-ec74e14b.js";import"./Clonable-b71fa929.js";import"./reactiveUtils-e7d9f86e.js";import"./BlendLayer-2e0705c7.js";import"./mat4f32-1b45b54f.js";import"./mat4-a6ac6b0f.js";import"./utils-064c64c4.js";import"./LRUCache-000d0e19.js";import"./Basemap-09ab572b.js";import"./loadAll-19f96669.js";import"./PortalItem-9d3416e3.js";import"./writeUtils-ef8a6958.js";import"./layerUtils-c805b05c.js";import"./compilerUtils-7f5a3043.js";import"./CollectionFlattener-1d70a253.js";import"./TablesMixin-a124ac1c.js";import"./Layer-668dff8a.js";import"./Identifiable-1430bdc2.js";import"./Cyclical-9ae8d24f.js";import"./jsonUtils-2c7f966c.js";import"./MultiOriginJSONSupport-9bd581c6.js";import"./Graphic-f1881791.js";import"./PopupTemplate-18f22683.js";import"./FeatureLayer-f68eb3e5.js";import"./ClassBreaksRenderer-aa69b6ca.js";import"./UniqueValueRenderer-983c9a3e.js";import"./diffUtils-d0e8b583.js";import"./colorRamps-bef5e122.js";import"./ColorStop-6cee3909.js";import"./visualVariableUtils-79811b9c.js";import"./lengthUtils-1e9c410b.js";import"./styleUtils-d9ef5ac0.js";import"./jsonUtils-7ee1282d.js";import"./Version-ef27dfc4.js";import"./FieldsIndex-9238b8b6.js";import"./UnknownTimeZone-8ede07af.js";import"./heatmapUtils-7a838493.js";import"./SimpleRenderer-2c5d637a.js";import"./commonProperties-0c35c2c9.js";import"./TimeExtent-579f0e32.js";import"./timeUtils-24502426.js";import"./ElevationInfo-e9f55e40.js";import"./FormTemplate-b1394f1a.js";import"./Field-be948aef.js";import"./fieldType-4834e8bc.js";import"./workers-1be2b889.js";import"./Connection-2d969448.js";import"./editsZScale-c4af7049.js";import"./queryZScale-b694be92.js";import"./zscale-d7e12601.js";import"./FeatureSet-32e85c3a.js";import"./APIKeyMixin-7c0d27b5.js";import"./ArcGISService-1a65aba0.js";import"./arcgisLayerUrl-0c479f71.js";import"./CustomParametersMixin-882f293c.js";import"./EditBusLayer-7f92d599.js";import"./uuid-709b6c67.js";import"./FeatureEffectLayer-f145f4bc.js";import"./Query-aaf746b1.js";import"./DataLayerSource-62d0bfcf.js";import"./FeatureLayerBase-5d10c7bd.js";import"./HeightModelInfo-46c4a968.js";import"./featureLayerUtils-87358b6a.js";import"./AttachmentQuery-36a8e4f4.js";import"./RelationshipQuery-722111d3.js";import"./LayerFloorInfo-88589fec.js";import"./serviceCapabilitiesUtils-d90db62d.js";import"./FeatureReductionLayer-b89875ed.js";import"./FeatureReductionSelection-d7d28c54.js";import"./LabelClass-bca4dcea.js";import"./defaults-473b7c21.js";import"./defaultsJSON-b087dd4d.js";import"./MD5-715f37cd.js";import"./OperationalLayer-04352719.js";import"./OrderedLayer-69f0528e.js";import"./PortalLayer-f8b97b56.js";import"./portalItemUtils-8aceb0b8.js";import"./projection-41da473c.js";import"./projectBuffer-af7b4ad9.js";import"./RefreshableLayer-9477518b.js";import"./ScaleRangeLayer-61383a56.js";import"./TemporalLayer-114f16ec.js";import"./TimeInfo-c87ecbc7.js";import"./FeatureTemplate-231bfadc.js";import"./FeatureType-d0808bff.js";import"./fieldProperties-663ad9a8.js";import"./labelingInfo-f5739018.js";import"./versionUtils-28beeff3.js";import"./styleUtils-f1a4091c.js";import"./TopFeaturesQuery-827caf55.js";import"./popupUtils-de5a8217.js";import"./interfaces-f1f22245.js";import"./jsonContext-70ccb9b3.js";import"./project-44b24f84.js";import"./utils-3234cfff.js";import"./utils-ed91a700.js";import"./TileInfo-d188b444.js";import"./jsxFactory-605eab60.js";import"./UpdatingHandles-431d86d1.js";import"./signal-b060d75f.js";import"./GraphicsCollection-393d5158.js";import"./QueueProcessor-79c89715.js";import"./ViewingMode-fb6259a5.js";import"./unitBezier-881ac1eb.js";import"./HighlightOptions-4299833f.js";import"./TileKey-a0a7eda8.js";import"./vec2-f44efd17.js";import"./quickselect-fcce738b.js";import"./_commonjsHelpers-2f3e7994.js";import"./vec2f64-b65bfd66.js";import"./normalizeUtils-059b11cb.js";import"./normalizeUtilsCommon-c4e9ddb1.js";import"./mat3-def297a7.js";import"./vec2f32-afca0b62.js";import"./capabilities-14956a41.js";import"./webStyleSymbolUtils-938d0140.js";import"./devEnvironmentUtils-4eab2a99.js";const R="picture-fill",J="picture-marker",K="simple-fill",N="simple-line",Q="simple-marker",X="text",Y="Aa",_=S.size,C=S.maxSize,$=S.maxOutlineSize,Z=S.lineWidth,A=225,ii=document.createElement("canvas");function q(o,i){const r=ii.getContext("2d"),t=[];i&&(i.weight&&t.push(i.weight),i.size&&t.push(i.size+"px"),i.family&&t.push(i.family)),r.font=t.join(" ");const{width:n,actualBoundingBoxLeft:l,actualBoundingBoxRight:u,actualBoundingBoxAscent:a,actualBoundingBoxDescent:h}=r.measureText(o);return{width:Math.ceil(Math.max(n,l+u)),height:Math.ceil(a+h),x:Math.floor(l),y:Math.floor((a-h)/2)}}function x(o){const i=o==null?void 0:o.size;return{width:i!=null&&typeof i=="object"&&"width"in i?w(i.width):null,height:i!=null&&typeof i=="object"&&"height"in i?w(i.height):null}}async function oi(o,i){const r=i.fill,t=o.color;if((r==null?void 0:r.type)==="pattern"&&t&&o.type!==R){const n=await W(r.src,t.toCss(!0));r.src=n,i.fill=r}}async function ti(o,i,r,t){var u,a,h;if(!("font"in o)||!o.font||i.shape.type!=="text")return;try{await U(o.font)}catch{}const{width:n,height:l}=x(t);if(!/[\uE600-\uE6FF]/.test(i.shape.text)){const{width:d,height:f,x:m,y:e}=q(i.shape.text,{weight:(u=i.font)==null?void 0:u.weight,size:(a=i.font)==null?void 0:a.size,family:(h=i.font)==null?void 0:h.family});r[0]=n??d,r[1]=l??f,i.shape.x=m,i.shape.y=e;const v=(t==null?void 0:t.rotation)!=null?t.rotation:"angle"in o?o.angle:null;if(v){const M=v*(Math.PI/180),s=Math.abs(Math.sin(M)),c=Math.abs(Math.cos(M));r[1]=r[0]*s+r[1]*c}}}function ri(o,i,r,t,n){var l;if(o.haloColor!=null&&o.haloSize!=null){n.masking??(n.masking=r.map(()=>[]));const u=w(o.haloSize);t[0]+=u,t[1]+=u,r.unshift([{...i,fill:null,stroke:{color:o.haloColor,width:2*u,join:"round",cap:"round"}}]),n.masking.unshift([{shape:{type:"rect",x:0,y:0,width:t[0]+2*L,height:t[1]+2*L},fill:[255,255,255],stroke:null},{...i,fill:[0,0,0,0],stroke:null}])}o.backgroundColor==null&&o.borderLineColor==null||(t[0]+=2*L,t[1]+=2*L,r.unshift([{shape:{type:"rect",x:0,y:0,width:t[0],height:t[1]},fill:o.backgroundColor,stroke:{color:o.borderLineColor,width:w(o.borderLineSize)}}]),(l=n.masking)==null||l.unshift([]))}function P(o,i){return o>i?"dark":"light"}function mi(o,i){var M;const r=typeof(i==null?void 0:i.size)=="number"?i==null?void 0:i.size:null,t=r!=null?w(r):null,n=(i==null?void 0:i.maxSize)!=null?w(i.maxSize):null,l=(i==null?void 0:i.rotation)!=null?i.rotation:"angle"in o?o.angle:null,u=T(o);let a=O(o);ei(o,245)!=="dark"||i!=null&&i.ignoreWhiteSymbols||(a={width:.75,...a,color:"#bdc3c7"});const h={shape:null,fill:u,stroke:a,offset:[0,0]};a!=null&&a.width&&(a.width=Math.min(a.width,$));const d=(a==null?void 0:a.width)||0;let f=(i==null?void 0:i.size)!=null&&((i==null?void 0:i.scale)==null||(i==null?void 0:i.scale)),m=0,e=0,v=!1;switch(o.type){case Q:{const s=o.style,{width:c,height:p}=x(i),b=c===p&&c!=null?c:t??Math.min(w(o.size),n||C);switch(m=b,e=b,s){case"circle":h.shape={type:"circle",cx:0,cy:0,r:.5*b},f||(m+=d,e+=d);break;case"cross":h.shape={type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",values:[m,.5*e]},{command:"M",values:[.5*m,0]},{command:"L",values:[.5*m,e]}]};break;case"diamond":h.shape={type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",values:[.5*m,0]},{command:"L",values:[m,.5*e]},{command:"L",values:[.5*m,e]},{command:"Z",values:[]}]},f||(m+=d,e+=d);break;case"square":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[m,0]},{command:"L",values:[m,e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]},f||(m+=d,e+=d),l&&(v=!0);break;case"triangle":h.shape={type:"path",path:[{command:"M",values:[.5*m,0]},{command:"L",values:[m,e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]},f||(m+=d,e+=d),l&&(v=!0);break;case"x":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[m,e]},{command:"M",values:[m,0]},{command:"L",values:[0,e]}]},l&&(v=!0);break;case"path":h.shape={type:"path",path:o.path||""},f||(m+=d,e+=d),l&&(v=!0),f=!0}break}case N:{const{width:s,height:c}=x(i),p=V(a).reduce((B,k)=>B+k,0),b=p&&Math.ceil(Z/p),y=c??t??d,g=s??(p*b||Z);a&&(a.width=y),m=g,e=y,f=!0,h.shape={type:"path",path:[{command:"M",values:[y/2,e/2]},{command:"L",values:[m-y/2,e/2]}]};break}case R:case K:{const s=typeof(i==null?void 0:i.symbolConfig)=="object"&&!!((M=i==null?void 0:i.symbolConfig)!=null&&M.isSquareFill),{width:c,height:p}=x(i);m=!s&&c!==p||c==null?t??_:c,e=!s&&c!==p||p==null?m:p,f||(m+=d,e+=d),f=!0,h.shape=s?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[m,0]},{command:"L",values:[m,e]},{command:"L",values:[0,e]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:I.fill[0];break}case J:{const s=Math.min(w(o.width),n||C),c=Math.min(w(o.height),n||C),{width:p,height:b}=x(i),y=p===b&&p!=null?p:t??Math.max(s,c),g=s/c;m=g<=1?Math.ceil(y*g):y,e=g<=1?y:Math.ceil(y/g),h.shape={type:"image",x:-Math.round(m/2),y:-Math.round(e/2),width:m,height:e,src:o.url||""},l&&(v=!0);break}case X:{const s=o,c=(i==null?void 0:i.overrideText)||s.text||Y,p=s.font,{width:b,height:y}=x(i),g=y??t??Math.min(w(p.size),n||C),{width:B,height:k}=q(c,{weight:p.weight,size:g,family:p.family}),z=/[\uE600-\uE6FF]/.test(c);m=b??(z?g:B),e=z?g:k;let j=.5*(z?g:k);z&&(j+=5),h.shape={type:"text",text:c,x:s.xoffset||0,y:s.yoffset||j,align:"middle",alignBaseline:s.verticalAlignment,decoration:p&&p.decoration,rotated:s.rotated,kerning:s.kerning},h.font=p&&{size:g,style:p.style,decoration:p.decoration,weight:p.weight,family:p.family};break}}return{shapeDescriptor:h,size:[m,e],renderOptions:{node:i==null?void 0:i.node,scale:f,opacity:i==null?void 0:i.opacity,rotation:l,useRotationSize:v,effectView:i==null?void 0:i.effectView,ariaLabel:i==null?void 0:i.ariaLabel}}}async function nr(o,i){var u;const{shapeDescriptor:r,size:t,renderOptions:n}=mi(o,i);if(!r.shape)throw new H("symbolPreview: renderPreviewHTML2D","symbol not supported.");await oi(o,r),await ti(o,r,t,i);const l=[[r]];if(typeof(i==null?void 0:i.symbolConfig)=="object"&&((u=i==null?void 0:i.symbolConfig)!=null&&u.applyColorModulation)){const a=.6*t[0];l.unshift([{...r,offset:[-a,0],fill:F(r.fill,-.3)}]),l.push([{...r,offset:[a,0],fill:F(r.fill,.3)}]),t[0]+=2*a,n.scale=!1}return o.type==="text"&&ri(o,r,l,t,n),G(l,t,n)}function ei(o,i=A){const r=T(o),t=O(o),n=!r||"type"in r?null:new E(r),l=t!=null&&t.color?new E(t==null?void 0:t.color):null,u=n?P(D(n),i):null,a=l?P(D(l),i):null;return a?u?u===a?u:i>=A?"light":"dark":a:u}export{ei as getContrastingBackgroundTheme,mi as getRenderSymbolParameters,nr as previewSymbol2D};
