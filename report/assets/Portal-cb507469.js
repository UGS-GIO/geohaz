import{_ as U,b as P,U as R,c as V}from"./request-a10d6950.js";import{e as r,c as _,d as J}from"./subclass-f7409b1b.js";import{b as z,a as g,c as w}from"./Error-21d1d076.js";import{y as o,S as F,f as $,u as k}from"./JSONSupport-acf2865c.js";import{m as K}from"./Loadable-8a1ead8b.js";import{u as b,l as W,s as N,f as x,a as E,p as Y}from"./promiseUtils-1d963c7c.js";import"./typedArrayUtil-2af43698.js";import{g as X,M as H,o as O}from"./Extent-2b4578b8.js";import{c as C}from"./locale-bde6d0f6.js";import{s as Z}from"./jsonMap-5ba4a9c2.js";import{f as tt}from"./SpatialReference-428523ee.js";let G;function et(t){return G&&!G.destroyed||(G=t()),G}var D;const rt=new Z({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let c=D=class extends F{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new D({categories:this.categories?z(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let s=[];this.categories&&(s=this.categories.map(u=>Array.isArray(u)?JSON.stringify(u):u));let a="";if(this.extent){const u=X(this.extent,tt.WGS84);u!=null&&(a=`${u.xmin},${u.ymin},${u.xmax},${u.ymax}`)}let l=this.query;!this.disableExtraQuery&&t.extraQuery&&(l="("+l+")"+t.extraQuery);const n={categories:s,bbox:a,q:l,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(u=>rt.toJSON(u.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};r([o()],c.prototype,"categories",void 0),r([o()],c.prototype,"disableExtraQuery",void 0),r([o({type:H})],c.prototype,"extent",void 0),r([o()],c.prototype,"filter",void 0),r([o()],c.prototype,"num",void 0),r([o()],c.prototype,"query",void 0),r([o()],c.prototype,"sortField",void 0),r([o()],c.prototype,"sortOrder",null),r([o()],c.prototype,"start",void 0),c=D=r([_("esri.portal.PortalQueryParams")],c);const f=c;var I;let h=I=class extends ${constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){var s;const t=this.url,e=this.thumbnail;return t&&e&&this.portal?(s=this.portal)==null?void 0:s.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const s=e.categorySchema||[];return s.some(a=>a.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):s})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new g("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new I;return e.sourceJSON=t,e.read(t),e}queryItems(t,e){let s=J(f,t);const a=this.portal;return parseFloat(a.currentVersion)>5?(s=s||new f,a.queryPortal(`/content/groups/${this.id}/search`,s,"PortalItem",e)):(s=s?s.clone():new f,s.query="group:"+this.id+(s.query?" "+s.query:""),a.queryItems(s,e))}_fetchCategorySchemaSet(t,e){const s=this.portal;return s.fetchSelf(s.authMode,!0,e).then(a=>{const l=a.contentCategorySetsGroupQuery;if(l){const n=new f;return n.disableExtraQuery=!0,n.num=1,n.query=l,s.queryGroups(n,e)}throw new g("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(a=>{if(a.total){const l=a.results[0],n=new f;return n.num=1,n.query=`typekeywords:"${t}"`,l.queryItems(n,e)}throw new g("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(a=>a.total?a.results[0].fetchData("json",e).then(l=>{const n=l==null?void 0:l.categorySchema;return n!=null&&n.length?n:[]}):[])}};r([o()],h.prototype,"access",void 0),r([o({type:Date})],h.prototype,"created",void 0),r([o()],h.prototype,"description",void 0),r([o()],h.prototype,"id",void 0),r([o()],h.prototype,"isInvitationOnly",void 0),r([o({type:Date})],h.prototype,"modified",void 0),r([o()],h.prototype,"owner",void 0),r([o()],h.prototype,"portal",void 0),r([o()],h.prototype,"snippet",void 0),r([o()],h.prototype,"sortField",void 0),r([o()],h.prototype,"sortOrder",void 0),r([o()],h.prototype,"sourceJSON",void 0),r([o()],h.prototype,"tags",void 0),r([o()],h.prototype,"thumbnail",void 0),r([o({readOnly:!0})],h.prototype,"thumbnailUrl",null),r([o()],h.prototype,"title",void 0),r([o({readOnly:!0})],h.prototype,"url",null),h=I=r([_("esri.portal.PortalGroup")],h);const Q=h;let S=class extends F{constructor(t){super(t),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};r([o()],S.prototype,"nextQueryParams",void 0),r([o()],S.prototype,"queryParams",void 0),r([o()],S.prototype,"results",void 0),r([o()],S.prototype,"total",void 0),S=r([_("esri.portal.PortalQueryResult")],S);const ot=S;let v=class extends ${constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){var s;const e=(s=this.portal)==null?void 0:s.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new g("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};r([o({type:Date})],v.prototype,"created",void 0),r([o()],v.prototype,"id",void 0),r([o()],v.prototype,"portal",void 0),r([o()],v.prototype,"title",void 0),r([o({readOnly:!0})],v.prototype,"url",null),r([o()],v.prototype,"username",void 0),v=r([_("esri.portal.PortalFolder")],v);const st=v;var M;let p=M=class extends ${constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,s=t==null?void 0:t.data,a=t==null?void 0:t.folder,l={method:"post"};e&&(l.query=e.createPostQuery(),s!=null&&(typeof s=="string"?l.query.text=s:typeof s=="object"&&(l.query.text=JSON.stringify(s))));let n=this.userContentUrl;return a&&(n+="/"+(typeof a=="string"?a:a.id)),this.portal.request(n+"/addItem",l).then(u=>(e.id=u.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",s=t.map(a=>a.id);if(s.length){const a={method:"post",query:{items:s.join(",")}};return this.portal.request(e,a).then(()=>{t.forEach(l=>{l.id=null,l.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let s;return s=e&&e.folders?e.folders.map(a=>{const l=st.fromJSON(a);return l.portal=this.portal,l}):[],s})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(s=>{const a=Q.fromJSON(s);return a.portal=this.portal,a}):[],e})}fetchItems(t){const e=t??{};let s,a=this.userContentUrl??"";return e.folder&&(a+="/"+e.folder.id),U(()=>import("./PortalItem-9d3416e3.js"),["./PortalItem-9d3416e3.js","./request-a10d6950.js","./Error-21d1d076.js","./typedArrayUtil-2af43698.js","./JSONSupport-acf2865c.js","./subclass-f7409b1b.js","./promiseUtils-1d963c7c.js","./time-0817624a.js","./assets-6fd92e57.js","./Loadable-8a1ead8b.js","./Promise-ec74e14b.js","./Extent-2b4578b8.js","./SpatialReference-428523ee.js","./jsonMap-5ba4a9c2.js","./cast-e7a2f9aa.js","./persistableUrlUtils-ca6bb38d.js","./locale-bde6d0f6.js"],import.meta.url).then(({default:l})=>{s=l;const n={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(a,{query:n})}).then(l=>{let n;return l!=null&&l.items?(n=l.items.map(u=>{const d=s.fromJSON(u);return d.portal=this.portal,d}),Promise.all(n.map(u=>u.load())).catch(u=>u).then(()=>({items:n,nextStart:l.nextStart,total:l.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new Q({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new g("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new g("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new M;return e.sourceJSON=t,e.read(t),e}};r([o()],p.prototype,"access",void 0),r([o({type:Date})],p.prototype,"created",void 0),r([o()],p.prototype,"culture",void 0),r([o()],p.prototype,"description",void 0),r([o()],p.prototype,"email",void 0),r([o()],p.prototype,"favGroupId",void 0),r([o()],p.prototype,"fullName",void 0),r([o({type:Date})],p.prototype,"modified",void 0),r([o()],p.prototype,"orgId",void 0),r([o()],p.prototype,"portal",void 0),r([o()],p.prototype,"preferredView",void 0),r([o()],p.prototype,"privileges",void 0),r([o()],p.prototype,"region",void 0),r([o()],p.prototype,"role",void 0),r([o()],p.prototype,"roleId",void 0),r([o()],p.prototype,"sourceJSON",void 0),r([o()],p.prototype,"thumbnail",void 0),r([o({readOnly:!0})],p.prototype,"thumbnailUrl",null),r([o()],p.prototype,"units",void 0),r([o({readOnly:!0})],p.prototype,"userContentUrl",null),r([o({readOnly:!0})],p.prototype,"url",null),r([o()],p.prototype,"username",void 0),r([o()],p.prototype,"userType",void 0),p=M=r([_("esri.portal.PortalUser")],p);const L=p;var y;let q;const T={PortalGroup:()=>Promise.resolve({default:Q}),PortalItem:()=>U(()=>import("./PortalItem-9d3416e3.js"),["./PortalItem-9d3416e3.js","./request-a10d6950.js","./Error-21d1d076.js","./typedArrayUtil-2af43698.js","./JSONSupport-acf2865c.js","./subclass-f7409b1b.js","./promiseUtils-1d963c7c.js","./time-0817624a.js","./assets-6fd92e57.js","./Loadable-8a1ead8b.js","./Promise-ec74e14b.js","./Extent-2b4578b8.js","./SpatialReference-428523ee.js","./jsonMap-5ba4a9c2.js","./cast-e7a2f9aa.js","./persistableUrlUtils-ca6bb38d.js","./locale-bde6d0f6.js"],import.meta.url),PortalUser:()=>Promise.resolve({default:L})};let i=y=class extends k(K){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=w.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){A.unregister(this),this.defaultBasemap=b(this.defaultBasemap),this.defaultDevBasemap=b(this.defaultDevBasemap),this.defaultVectorBasemap=b(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=W(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)w.request.trustedServers.includes(e)||w.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){var s;const t=(s=this.user)==null?void 0:s.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=L.fromJSON(t),e.portal=this),e}load(t){const e=U(()=>import("./Basemap-09ab572b.js").then(s=>s.B),["./Basemap-09ab572b.js","./request-a10d6950.js","./Error-21d1d076.js","./typedArrayUtil-2af43698.js","./JSONSupport-acf2865c.js","./subclass-f7409b1b.js","./promiseUtils-1d963c7c.js","./time-0817624a.js","./Collection-aa6ef54b.js","./Evented-b5127116.js","./SimpleObservable-ae589a25.js","./collectionUtils-b6e30316.js","./Loadable-8a1ead8b.js","./Promise-ec74e14b.js","./loadAll-19f96669.js","./SpatialReference-428523ee.js","./jsonMap-5ba4a9c2.js","./assets-6fd92e57.js","./PortalItem-9d3416e3.js","./Extent-2b4578b8.js","./cast-e7a2f9aa.js","./persistableUrlUtils-ca6bb38d.js","./locale-bde6d0f6.js","./messages-2d262041.js","./writeUtils-ef8a6958.js","./layerUtils-c805b05c.js"],import.meta.url).then(({default:s})=>{N(t),q=s}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(s=>{var a;if(P){const l=P;this.credential=l.findCredential(this.restUrl),this.credential||this.authMode!==y.AUTH_MODE_AUTO&&this.authMode!==y.AUTH_MODE_NO_PROMPT||((a=this._esriIdCredentialCreateHandle)==null||a.remove(),this._esriIdCredentialCreateHandle=l.on("credential-create",it(new WeakRef(this))),A.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=s,this.read(s)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await U(()=>import("./ElevationLayer-4acec8aa.js"),["./ElevationLayer-4acec8aa.js","./request-a10d6950.js","./Error-21d1d076.js","./typedArrayUtil-2af43698.js","./JSONSupport-acf2865c.js","./subclass-f7409b1b.js","./promiseUtils-1d963c7c.js","./time-0817624a.js","./MultiOriginJSONSupport-9bd581c6.js","./Extent-2b4578b8.js","./SpatialReference-428523ee.js","./jsonMap-5ba4a9c2.js","./assets-6fd92e57.js","./cast-e7a2f9aa.js","./HeightModelInfo-46c4a968.js","./Layer-668dff8a.js","./geometry-31b45acd.js","./Polyline-013cde1f.js","./aaBoundingRect-aef00841.js","./Axis-30be7e73.js","./mathUtils-19b6edfc.js","./typeUtils-3056a943.js","./Evented-b5127116.js","./Identifiable-1430bdc2.js","./Loadable-8a1ead8b.js","./Promise-ec74e14b.js","./ArcGISCachedService-be50ac44.js","./TileInfo-d188b444.js","./TileInfoTilemapCache-f6b6c6df.js","./TilemapCache-a4744968.js","./ByteSizeUnit-d4757d40.js","./LRUCache-000d0e19.js","./reactiveUtils-e7d9f86e.js","./Collection-aa6ef54b.js","./SimpleObservable-ae589a25.js","./ArcGISService-1a65aba0.js","./arcgisLayerUrl-0c479f71.js","./persistableUrlUtils-ca6bb38d.js","./OperationalLayer-04352719.js","./commonProperties-0c35c2c9.js","./TimeExtent-579f0e32.js","./timeUtils-24502426.js","./date-7940da18.js","./locale-bde6d0f6.js","./datetime-7e00d9ef.js","./ElevationInfo-e9f55e40.js","./fieldUtils-fcb2a714.js","./intl-fe039018.js","./messages-2d262041.js","./lengthUtils-1e9c410b.js","./opacityUtils-f0a081b4.js","./PortalLayer-f8b97b56.js","./layerUtils-c805b05c.js","./PortalItem-9d3416e3.js","./portalItemUtils-8aceb0b8.js","./projection-41da473c.js","./projectBuffer-af7b4ad9.js","./zscale-d7e12601.js","./workers-1be2b889.js","./Connection-2d969448.js"],import.meta.url)).default;return t?t.map(s=>new e({id:s.id,url:s.url})):[]}async fetchBasemaps(t,e){const s=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const a=await this._fetchBasemaps3D(t,e);s.unshift(...a)}return s}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):x(t)?Promise.reject(E()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,s=new f;if(s.num=100,s.sortField="title",e&&e.length){const a=[];for(const l of e)a.push(`(title:"${l.title}" AND owner:${l.owner})`);return s.query=a.join(" OR "),this.queryGroups(s,t).then(l=>l.results)}return x(t)?Promise.reject(E()):Promise.resolve([])}fetchRegions(t){var s;const e=((s=this.user)==null?void 0:s.culture)||this.culture||C();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var s;const e=((s=this.user)==null?void 0:s.culture)||this.culture||C();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return et(()=>new y)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,s){const a=this.restUrl+"/portals/self",l={authMode:t,query:{culture:C().toLowerCase()},withCredentials:!0,...s};return l.authMode==="auto"&&(l.authMode="no-prompt"),e&&(l.query.default=!0),this.request(a,l)}queryPortal(t,e,s,a){const l=J(f,e),n=u=>this.request(this.restUrl+t,{...l.toRequestOptions(this),...a}).then(d=>{const m=l.clone();return m.start=d.nextStart,new ot({nextQueryParams:m,queryParams:l,total:d.total,results:y._resultsToTypedArray(u,{portal:this},d,a)})}).then(d=>Promise.all(d.results.map(m=>typeof m.when=="function"?m.when():d)).then(()=>d,m=>(Y(m),d)));return s&&T[s]?T[s]().then(({default:u})=>(N(a),n(u))):n()}signIn(){if(this.authMode===y.AUTH_MODE_ANONYMOUS||this.authMode===y.AUTH_MODE_NO_PROMPT&&!P)return Promise.reject(new g("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(s=>{s&&(this.sourceJSON=s,this.read(s))});return P?P.getCredential(this.restUrl,{prompt:this.authMode!==y.AUTH_MODE_NO_PROMPT}).then(e=>t(e)):t(this.credential)}normalizeUrl(t){var s;const e=(s=this.credential)==null?void 0:s.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,s){return this.request(t,e).then(a=>{const l=y._resultsToTypedArray(s,{portal:this},a);return Promise.all(l.map(n=>typeof n.when=="function"?n.when():a)).then(()=>l,()=>l)})}request(t,e={}){const s={f:"json",...e.query},{authMode:a=this.authMode===y.AUTH_MODE_ANONYMOUS||this.authMode===y.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:l=null,cacheBust:n=!1,method:u="auto",responseType:d="json",signal:m}=e,B={authMode:a,body:l,cacheBust:n,method:u,query:s,responseType:d,timeout:0,signal:m};return e.withCredentials&&(B.withCredentials=!0),R(this._normalizeSSL(t),B).then(j=>j.data)}toJSON(){throw new g("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new y({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new g("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const s=new f;s.query=t||(w.apiKey&&V(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),s.disableExtraQuery=!0;const a=await this.queryGroups(s,e);if(!a.total)return[];const l=a.results[0];s.num=100,s.query='type:"Web Map" -type:"Web Application"',s.sortField=l.sortField||"name",s.sortOrder=l.sortOrder||"desc";const n=await l.queryItems(s,e);return n.total?n.results.filter(u=>u.type==="Web Map").map(u=>new q({portalItem:u})):[]}async _fetchBasemaps3D(t,e){const s=t||this.basemapGalleryGroupQuery3D;if(!s)return[];const a=new f({query:s,disableExtraQuery:!0}),l=await this.queryGroups(a,e);if(!l.total)return[];const n=l.results[0];a.num=100,a.query='type:"Web Scene"',a.sortField=n.sortField||"name",a.sortOrder=n.sortOrder||"desc";const u=await n.queryItems(a,e);return u.total?u.results.filter(d=>d.type==="Web Scene").map(d=>new q({portalItem:d})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=q.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,s,a){let l=[];if(s){const n=a!=null?a.signal:null;l=s.listings||s.notifications||s.userInvitations||s.tags||s.items||s.groups||s.comments||s.provisions||s.results||s.relatedItems||s,(t||e)&&(l=l.map(u=>{const d=Object.assign(t?t.fromJSON(u):u,e);return typeof d.load=="function"&&d.load(n),d}))}else l=[];return l}};i.AUTH_MODE_ANONYMOUS="anonymous",i.AUTH_MODE_AUTO="auto",i.AUTH_MODE_IMMEDIATE="immediate",i.AUTH_MODE_NO_PROMPT="no-prompt",r([o()],i.prototype,"access",void 0),r([o()],i.prototype,"allSSL",void 0),r([o()],i.prototype,"authMode",void 0),r([o()],i.prototype,"authorizedCrossOriginDomains",void 0),r([O("authorizedCrossOriginDomains")],i.prototype,"readAuthorizedCrossOriginDomains",null),r([o()],i.prototype,"basemapGalleryGroupQuery",void 0),r([o({json:{name:"3DBasemapGalleryGroupQuery"}})],i.prototype,"basemapGalleryGroupQuery3D",void 0),r([o()],i.prototype,"bingKey",void 0),r([o()],i.prototype,"canListApps",void 0),r([o()],i.prototype,"canListData",void 0),r([o()],i.prototype,"canListPreProvisionedItems",void 0),r([o()],i.prototype,"canProvisionDirectPurchase",void 0),r([o()],i.prototype,"canSearchPublic",void 0),r([o()],i.prototype,"canShareBingPublic",void 0),r([o()],i.prototype,"canSharePublic",void 0),r([o()],i.prototype,"canSignInArcGIS",void 0),r([o()],i.prototype,"canSignInIDP",void 0),r([o()],i.prototype,"colorSetsGroupQuery",void 0),r([o()],i.prototype,"commentsEnabled",void 0),r([o({type:Date})],i.prototype,"created",void 0),r([o()],i.prototype,"credential",void 0),r([o()],i.prototype,"culture",void 0),r([o()],i.prototype,"currentVersion",void 0),r([o()],i.prototype,"customBaseUrl",void 0),r([o()],i.prototype,"defaultBasemap",void 0),r([O("defaultBasemap")],i.prototype,"readDefaultBasemap",null),r([o()],i.prototype,"defaultDevBasemap",void 0),r([O("defaultDevBasemap")],i.prototype,"readDefaultDevBasemap",null),r([o({type:H})],i.prototype,"defaultExtent",void 0),r([o()],i.prototype,"defaultVectorBasemap",void 0),r([O("defaultVectorBasemap")],i.prototype,"readDefaultVectorBasemap",null),r([o()],i.prototype,"description",void 0),r([o()],i.prototype,"devBasemapGalleryGroupQuery",void 0),r([o()],i.prototype,"eueiEnabled",void 0),r([o({readOnly:!0})],i.prototype,"extraQuery",null),r([o()],i.prototype,"featuredGroups",void 0),r([o()],i.prototype,"featuredItemsGroupQuery",void 0),r([o()],i.prototype,"galleryTemplatesGroupQuery",void 0),r([o()],i.prototype,"layoutGroupQuery",void 0),r([o()],i.prototype,"livingAtlasGroupQuery",void 0),r([o()],i.prototype,"hasCategorySchema",void 0),r([o()],i.prototype,"helpBase",void 0),r([o()],i.prototype,"helperServices",void 0),r([o()],i.prototype,"helpMap",void 0),r([o()],i.prototype,"homePageFeaturedContent",void 0),r([o()],i.prototype,"homePageFeaturedContentCount",void 0),r([o()],i.prototype,"httpPort",void 0),r([o()],i.prototype,"httpsPort",void 0),r([o()],i.prototype,"id",void 0),r([o()],i.prototype,"ipCntryCode",void 0),r([o({readOnly:!0})],i.prototype,"isOrganization",null),r([o()],i.prototype,"isPortal",void 0),r([o()],i.prototype,"isReadOnly",void 0),r([o({readOnly:!0})],i.prototype,"itemPageUrl",null),r([o()],i.prototype,"layerTemplatesGroupQuery",void 0),r([o()],i.prototype,"maxTokenExpirationMinutes",void 0),r([o({type:Date})],i.prototype,"modified",void 0),r([o()],i.prototype,"name",void 0),r([o()],i.prototype,"portalHostname",void 0),r([o()],i.prototype,"portalMode",void 0),r([o()],i.prototype,"portalProperties",void 0),r([o()],i.prototype,"region",void 0),r([o({readOnly:!0})],i.prototype,"restUrl",null),r([o()],i.prototype,"rotatorPanels",void 0),r([o()],i.prototype,"showHomePageDescription",void 0),r([o()],i.prototype,"sourceJSON",void 0),r([o()],i.prototype,"staticImagesUrl",void 0),r([o({json:{name:"2DStylesGroupQuery"}})],i.prototype,"stylesGroupQuery2d",void 0),r([o({json:{name:"stylesGroupQuery"}})],i.prototype,"stylesGroupQuery3d",void 0),r([o()],i.prototype,"supportsHostedServices",void 0),r([o()],i.prototype,"symbolSetsGroupQuery",void 0),r([o()],i.prototype,"templatesGroupQuery",void 0),r([o()],i.prototype,"thumbnail",void 0),r([o({readOnly:!0})],i.prototype,"thumbnailUrl",null),r([o()],i.prototype,"units",void 0),r([o()],i.prototype,"url",void 0),r([o()],i.prototype,"urlKey",void 0),r([O("urlKey")],i.prototype,"readUrlKey",null),r([o()],i.prototype,"user",void 0),r([O("user")],i.prototype,"readUser",null),r([o()],i.prototype,"use3dBasemaps",void 0),r([o()],i.prototype,"useStandardizedQuery",void 0),r([o()],i.prototype,"useVectorBasemaps",void 0),r([o()],i.prototype,"vectorBasemapGalleryGroupQuery",void 0),i=y=r([_("esri.portal.Portal")],i);const gt=i,A=new FinalizationRegistry(t=>{t.remove()});function it(t){const e=P;return()=>{const s=t.deref();s&&e.findCredential(s.restUrl)&&s.signIn().catch(()=>{})}}export{gt as Q,f as c,L as p};
