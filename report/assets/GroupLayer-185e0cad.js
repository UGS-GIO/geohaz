import{_ as u}from"./request-a10d6950.js";import{t as b,e as o,c as v}from"./subclass-f7409b1b.js";import{l as c}from"./CollectionFlattener-1d70a253.js";import{t as f}from"./loadAll-19f96669.js";import{s as _}from"./Error-21d1d076.js";import{m as w}from"./MultiOriginJSONSupport-9bd581c6.js";import{k as g,p as I}from"./promiseUtils-1d963c7c.js";import{d,A as L,v as O,C as y}from"./reactiveUtils-e7d9f86e.js";import{k as S,y as l}from"./JSONSupport-acf2865c.js";import"./typedArrayUtil-2af43698.js";import{o as A}from"./Extent-2b4578b8.js";import{r as h}from"./SpatialReference-428523ee.js";import{b as V}from"./Layer-668dff8a.js";import{n as $}from"./BlendLayer-2e0705c7.js";import{u as P}from"./OperationalLayer-04352719.js";import{j as E}from"./PortalLayer-f8b97b56.js";import{t as M}from"./ScaleRangeLayer-61383a56.js";import{a as C}from"./lazyLayerLoader-b21a171b.js";import T from"./PortalItem-9d3416e3.js";import{n as x,d as G,t as R}from"./TablesMixin-a124ac1c.js";import{A as m}from"./interfaces-f1f22245.js";import{r as j}from"./saveUtils-534df74b.js";import{f as H}from"./writeUtils-ef8a6958.js";import"./Collection-aa6ef54b.js";import"./Evented-b5127116.js";import"./SimpleObservable-ae589a25.js";import"./Loadable-8a1ead8b.js";import"./Promise-ec74e14b.js";import"./time-0817624a.js";import"./cast-e7a2f9aa.js";import"./jsonMap-5ba4a9c2.js";import"./assets-6fd92e57.js";import"./geometry-31b45acd.js";import"./Polyline-013cde1f.js";import"./aaBoundingRect-aef00841.js";import"./Axis-30be7e73.js";import"./mathUtils-19b6edfc.js";import"./typeUtils-3056a943.js";import"./Identifiable-1430bdc2.js";import"./colorUtils-ac6863dc.js";import"./screenUtils-7afeb41c.js";import"./mat4f32-1b45b54f.js";import"./mat4-a6ac6b0f.js";import"./commonProperties-0c35c2c9.js";import"./TimeExtent-579f0e32.js";import"./timeUtils-24502426.js";import"./date-7940da18.js";import"./locale-bde6d0f6.js";import"./datetime-7e00d9ef.js";import"./persistableUrlUtils-ca6bb38d.js";import"./ElevationInfo-e9f55e40.js";import"./fieldUtils-fcb2a714.js";import"./intl-fe039018.js";import"./messages-2d262041.js";import"./lengthUtils-1e9c410b.js";import"./opacityUtils-f0a081b4.js";import"./layerUtils-c805b05c.js";import"./Portal-cb507469.js";import"./portalItemUtils-8aceb0b8.js";import"./projection-41da473c.js";import"./projectBuffer-af7b4ad9.js";import"./zscale-d7e12601.js";import"./collectionUtils-b6e30316.js";const F=Symbol("WebScene");let r=class extends $(M(P(E(x(G(w(V))))))){constructor(i){super(i),this.allLayers=new c({getCollections:()=>[this.layers],getChildrenFunction:e=>"layers"in e?e.layers:null}),this.allTables=R(this),this.fullExtent=void 0,this.operationalLayerType="GroupLayer",this.spatialReference=void 0,this.type="group",this._debouncedSaveOperations=g(async(e,t,s)=>{const{save:a,saveAs:p}=await u(()=>import("./groupLayerUtils-7b5fd8cd.js"),["./groupLayerUtils-7b5fd8cd.js","./utils-df330680.js","./Error-21d1d076.js","./typedArrayUtil-2af43698.js","./originUtils-cfe4feaf.js","./multiOriginJSONSupportUtils-c978f4c3.js","./Portal-cb507469.js","./request-a10d6950.js","./JSONSupport-acf2865c.js","./subclass-f7409b1b.js","./promiseUtils-1d963c7c.js","./time-0817624a.js","./Loadable-8a1ead8b.js","./Promise-ec74e14b.js","./Extent-2b4578b8.js","./SpatialReference-428523ee.js","./jsonMap-5ba4a9c2.js","./assets-6fd92e57.js","./cast-e7a2f9aa.js","./locale-bde6d0f6.js","./PortalItem-9d3416e3.js","./persistableUrlUtils-ca6bb38d.js","./jsonContext-70ccb9b3.js","./portalItemUtils-8aceb0b8.js","./projection-41da473c.js","./SimpleObservable-ae589a25.js","./mathUtils-19b6edfc.js","./Polyline-013cde1f.js","./aaBoundingRect-aef00841.js","./Axis-30be7e73.js","./projectBuffer-af7b4ad9.js","./zscale-d7e12601.js","./saveAPIKeyUtils-7fbece8f.js","./saveUtils-534df74b.js","./resourceUtils-1b55d47f.js","./uuid-709b6c67.js","./resourceUtils-09076ff8.js"],import.meta.url);switch(e){case m.SAVE:return a(this,t);case m.SAVE_AS:return p(this,s,t)}})}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([d(()=>{let i=this.parent;for(;i&&"parent"in i&&i.parent;)i=i.parent;return i&&F in i},i=>{const e="prevent-adding-tables";this.removeHandles(e),i&&(this.tables.removeAll(),this.addHandles(O(()=>this.tables,"before-add",t=>{t.preventDefault(),_.getLogger(this).errorOnce("tables","tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.")}),e))},L),d(()=>this.visible,this._onVisibilityChange.bind(this),y)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf("portalItem")===S.USER}_writeLayers(i,e,t,s){const a=[];if(!i)return a;i.forEach(p=>{const n=H(p,s.webmap?s.webmap.getLayerJSONFromResourceInfo(p):null,s);n!=null&&n.layerType&&a.push(n)}),e.layers=a}set portalItem(i){this._set("portalItem",i)}readPortalItem(i,e,t){const{itemId:s,layerType:a}=e;if(a==="GroupLayer"&&s)return new T({id:s,portal:t==null?void 0:t.portal})}writePortalItem(i,e){i!=null&&i.id&&(e.itemId=i.id)}set visibilityMode(i){const e=this._get("visibilityMode")!==i;this._set("visibilityMode",i),e&&this._enforceVisibility(i,this.visible)}async beforeSave(){return j(this)}load(i){const e=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Group Layer","Scene Service"],layerModuleTypeMap:C},i).catch(t=>{if(I(t),this.sourceIsPortalItem)throw t});return this.addResolvingPromise(e),Promise.resolve(this)}async loadAll(){return f(this,i=>{i(this.layers,this.tables)})}async save(i){return this._debouncedSaveOperations(m.SAVE,i)}async saveAs(i,e){return this._debouncedSaveOperations(m.SAVE_AS,e,i)}layerAdded(i){i.visible&&this.visibilityMode==="exclusive"?this._turnOffOtherLayers(i):this.visibilityMode==="inherited"&&(i.visible=this.visible),this.hasHandles(i.uid)?console.error(`Layer read to Grouplayer: uid=${i.uid}`):this.addHandles(d(()=>i.visible,e=>this._onChildVisibilityChange(i,e),y),i.uid)}layerRemoved(i){this.removeHandles(i.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(i){this.layers.forEach(e=>{e!==i&&(e.visible=!1)})}_enforceVisibility(i,e){if(!b(this).initialized)return;const t=this.layers;let s=t.find(a=>a.visible);switch(i){case"exclusive":t.length&&!s&&(s=t.at(0),s.visible=!0),this._turnOffOtherLayers(s);break;case"inherited":t.forEach(a=>{a.visible=e})}}_onVisibilityChange(i){this.visibilityMode==="inherited"&&this.layers.forEach(e=>{e.visible=i})}_onChildVisibilityChange(i,e){switch(this.visibilityMode){case"exclusive":e?this._turnOffOtherLayers(i):this._isAnyLayerVisible()||(i.visible=!0);break;case"inherited":i.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some(i=>i.visible)}};o([l({readOnly:!0,dependsOn:[]})],r.prototype,"allLayers",void 0),o([l({readOnly:!0})],r.prototype,"allTables",void 0),o([l({json:{read:!0,write:!0}})],r.prototype,"blendMode",void 0),o([l()],r.prototype,"fullExtent",void 0),o([l({readOnly:!0})],r.prototype,"sourceIsPortalItem",null),o([l({json:{read:!1,write:{ignoreOrigin:!0}}})],r.prototype,"layers",void 0),o([h("layers")],r.prototype,"_writeLayers",null),o([l({type:["GroupLayer"]})],r.prototype,"operationalLayerType",void 0),o([l({json:{origins:{"web-map":{read:!1,write:{overridePolicy(i,e,t){return{enabled:(i==null?void 0:i.type)==="Group Layer"&&(t==null?void 0:t.initiator)!==this}}}},"web-scene":{read:!1,write:!1}}}})],r.prototype,"portalItem",null),o([A("web-map","portalItem",["itemId"])],r.prototype,"readPortalItem",null),o([h("web-map","portalItem",{itemId:{type:String}})],r.prototype,"writePortalItem",null),o([l()],r.prototype,"spatialReference",void 0),o([l({json:{read:!1},readOnly:!0,value:"group"})],r.prototype,"type",void 0),o([l({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{type:["independent","exclusive"],write:(i,e,t)=>{i!=="inherited"&&(e[t]=i)}}}}})],r.prototype,"visibilityMode",null),r=o([v("esri.layers.GroupLayer")],r);const Ki=r;export{Ki as default};
