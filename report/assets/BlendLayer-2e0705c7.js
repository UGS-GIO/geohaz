import{e as Z,c as rr}from"./subclass-f7409b1b.js";import{y as Ct}from"./JSONSupport-acf2865c.js";import"./typedArrayUtil-2af43698.js";import{a as M,o as nr}from"./Error-21d1d076.js";import{l as ar,i as or,r as sr,a as ur,o as ir}from"./colorUtils-ac6863dc.js";import{e as cr}from"./screenUtils-7afeb41c.js";import{e as _t}from"./mat4f32-1b45b54f.js";import{r as P,s as X}from"./mat4-a6ac6b0f.js";const lr=(e,r)=>{const o=P(e,r,0,0,0,0,r,0,0,0,0,r,0,0,0,0,1);return X(o,o)},fr=(e,r)=>{const o=P(e,r,0,0,.5-.5*r,0,r,0,.5-.5*r,0,0,r,.5-.5*r,0,0,0,1);return X(o,o)},hr=(e,r)=>{const o=1-r,c=P(e,.2126+.7874*o,.7152-.7152*o,.0722-.0722*o,0,.2126-.2126*o,.7152+.2848*o,.0722-.0722*o,0,.2126-.2126*o,.7152-.7152*o,.0722+.9278*o,0,0,0,0,1);return X(c,c)},pr=(e,r)=>{const o=Math.sin(r*Math.PI/180),c=Math.cos(r*Math.PI/180),i=P(e,.213+.787*c-.213*o,.715-.715*c-.715*o,.072-.072*c+.928*o,0,.213-.213*c+.143*o,.715+.285*c+.14*o,.072-.072*c-.283*o,0,.213-.213*c-.787*o,.715-.715*c+.715*o,.072+.928*c+.072*o,0,0,0,0,1);return X(i,i)},mr=(e,r)=>{const o=1-2*r,c=P(e,o,0,0,r,0,o,0,r,0,0,o,r,0,0,0,1);return X(c,c)},gr=(e,r)=>{const o=P(e,.213+.787*r,.715-.715*r,.072-.072*r,0,.213-.213*r,.715+.285*r,.072-.072*r,0,.213-.213*r,.715-.715*r,.072+.928*r,0,0,0,0,1);return X(o,o)},dr=(e,r)=>{const o=1-r,c=P(e,.393+.607*o,.769-.769*o,.189-.189*o,0,.349-.349*o,.686+.314*o,.168-.168*o,0,.272-.272*o,.534-.534*o,.131+.869*o,0,0,0,0,1);return X(c,c)};let Nt=class Rt{constructor(r,o,c){this.strength=r,this.radius=o,this.threshold=c,this.type="bloom"}interpolate(r,o,c){this.strength=C(r.strength,o.strength,c),this.radius=C(r.radius,o.radius,c),this.threshold=C(r.threshold,o.threshold,c)}clone(){return new Rt(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:T(this.radius),strength:this.strength,threshold:this.threshold}}},jt=class Jt{constructor(r){this.radius=r,this.type="blur"}interpolate(r,o,c){this.radius=Math.round(C(r.radius,o.radius,c))}clone(){return new Jt(this.radius)}toJSON(){return{type:"blur",radius:T(this.radius)}}};class U{constructor(r,o){this.type=r,this.amount=o,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(r,o,c){this.amount=C(r.amount,o.amount,c),this._updateMatrix()}clone(){return new U(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const r=this._colorMatrix||_t();switch(this.type){case"brightness":this._colorMatrix=lr(r,this.amount);break;case"contrast":this._colorMatrix=fr(r,this.amount);break;case"grayscale":this._colorMatrix=hr(r,this.amount);break;case"invert":this._colorMatrix=mr(r,this.amount);break;case"saturate":this._colorMatrix=gr(r,this.amount);break;case"sepia":this._colorMatrix=dr(r,this.amount)}}}let qt=class It{constructor(r,o,c,i){this.offsetX=r,this.offsetY=o,this.blurRadius=c,this.color=i,this.type="drop-shadow"}interpolate(r,o,c){this.offsetX=C(r.offsetX,o.offsetX,c),this.offsetY=C(r.offsetY,o.offsetY,c),this.blurRadius=C(r.blurRadius,o.blurRadius,c),this.color[0]=Math.round(C(r.color[0],o.color[0],c)),this.color[1]=Math.round(C(r.color[1],o.color[1],c)),this.color[2]=Math.round(C(r.color[2],o.color[2],c)),this.color[3]=C(r.color[3],o.color[3],c)}clone(){return new It(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const r=[...this.color];return r[3]*=255,{type:"drop-shadow",xoffset:T(this.offsetX),yoffset:T(this.offsetY),blurRadius:T(this.blurRadius),color:r}}},Pt=class Xt{constructor(r){this.angle=r,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(r,o,c){this.angle=C(r.angle,o.angle,c),this._updateMatrix()}clone(){return new Xt(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const r=this._colorMatrix||_t();this._colorMatrix=pr(r,this.angle)}},Yt=class zt{constructor(r){this.amount=r,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(r,o,c){this.amount=C(r.amount,o.amount,c)}clone(){return new zt(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function C(e,r,o){return e+(r-e)*o}function T(e){return Math.round(1e3*cr(e))/1e3}function yr(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new U(e.type,0);case"saturate":case"brightness":case"contrast":return new U(e.type,1);case"opacity":return new Yt(1);case"hue-rotate":return new Pt(0);case"blur":return new jt(0);case"drop-shadow":return new qt(0,0,0,[...ar("transparent")]);case"bloom":return new Nt(0,0,1)}}function vr(e,r){const o=e.length>r.length?e:r;return(e.length>r.length?r:e).every((c,i)=>c.type===o[i].type)}function wr(e,r){const o=e.length>r.length?e:r,c=e.length>r.length?r:e;for(let i=c.length;i<o.length;i++)c.push(yr(o[i]))}function xr(e){const r=e[0];return!!r&&"type"in r}var Ft,kt,Bt={exports:{}};kt=function(){function e(i,d){function v(){this.constructor=i}v.prototype=d.prototype,i.prototype=new v}function r(i,d,v,n){var y=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(y,r.prototype),y.expected=d,y.found=v,y.location=n,y.name="SyntaxError",y}function o(i,d,v){return v=v||" ",i.length>d?i:(d-=i.length,i+(v+=v.repeat(d)).slice(0,d))}function c(i,d){var v,n={},y=(d=d!==void 0?d:{}).grammarSource,O={start:$t},q=$t,I="none",Y=")",m=",",w="(",E="%",b="px",nt="cm",at="mm",ot="in",st="pt",ut="pc",it="deg",ct="rad",lt="grad",ft="turn",Dt="#",Gt=".",Ht="e",ht=/^[ \t\n\r]/,pt=/^[a-z\-]/,mt=/^[0-9a-fA-F]/,gt=/^[+\-]/,j=/^[0-9]/,Lt=N("none"),Kt=A("none",!1),Qt=A(")",!1),dt=A(",",!1),Vt=N("whitespace"),yt=B([" ","	",`
`,"\r"],!1,!1),Wt=N("function"),Zt=A("(",!1),te=N("identifier"),vt=B([["a","z"],"-"],!1,!1),ee=N("percentage"),re=A("%",!1),ne=N("length"),ae=A("px",!1),oe=A("cm",!1),se=A("mm",!1),ue=A("in",!1),ie=A("pt",!1),ce=A("pc",!1),le=N("angle"),fe=A("deg",!1),he=A("rad",!1),pe=A("grad",!1),me=A("turn",!1),ge=N("number"),de=N("color"),ye=A("#",!1),wt=B([["0","9"],["a","f"],["A","F"]],!1,!1),xt=B(["+","-"],!1,!1),J=B([["0","9"]],!1,!1),ve=A(".",!1),we=A("e",!1),xe=function(){return[]},be=function(t,s){return{type:"function",name:t,parameters:s||[]}},Ae=function(t,s){return s.length>0?er(t,s,3):[t]},$e=function(t){return{type:"quantity",value:t.value,unit:t.unit}},Me=function(t){return{type:"color",colorType:t.type,value:t.value}},Ce=function(t){return t},Fe=function(){return H()},ke=function(t){return{value:t,unit:"%"}},Oe=function(t){return{value:t,unit:"px"}},Ee=function(t){return{value:t,unit:"cm"}},Se=function(t){return{value:t,unit:"mm"}},_e=function(t){return{value:t,unit:"in"}},Ne=function(t){return{value:t,unit:"pt"}},Re=function(t){return{value:t,unit:"pc"}},je=function(t){return{value:t,unit:"deg"}},Je=function(t){return{value:t,unit:"rad"}},qe=function(t){return{value:t,unit:"grad"}},Ie=function(t){return{value:t,unit:"turn"}},Pe=function(t){return{value:t,unit:null}},Xe=function(){return{type:"hex",value:H()}},Ye=function(t){return{type:"function",value:t}},ze=function(){return{type:"named",value:H()}},Be=function(){return parseFloat(H())},a=0,g=0,G=[{line:1,column:1}],_=0,Q=[],l=0;if("startRule"in d){if(!(d.startRule in O))throw new Error(`Can't start parsing from rule "`+d.startRule+'".');q=O[d.startRule]}function H(){return i.substring(g,a)}function A(t,s){return{type:"literal",text:t,ignoreCase:s}}function B(t,s,u){return{type:"class",parts:t,inverted:s,ignoreCase:u}}function Te(){return{type:"end"}}function N(t){return{type:"other",description:t}}function bt(t){var s,u=G[t];if(u)return u;for(s=t-1;!G[s];)s--;for(u={line:(u=G[s]).line,column:u.column};s<t;)i.charCodeAt(s)===10?(u.line++,u.column=1):u.column++,s++;return G[t]=u,u}function At(t,s,u){var h=bt(t),x=bt(s),p={source:y,start:{offset:t,line:h.line,column:h.column},end:{offset:s,line:x.line,column:x.column}};return u&&y&&typeof y.offset=="function"&&(p.start=y.offset(p.start),p.end=y.offset(p.end)),p}function f(t){a<_||(a>_&&(_=a,Q=[]),Q.push(t))}function Ue(t,s,u){return new r(r.buildMessage(t,s),t,s,u)}function $t(){var t;return(t=De())===n&&(t=Ge()),t}function De(){var t,s;return l++,t=a,$(),i.substr(a,4)===I?(s=I,a+=4):(s=n,l===0&&f(Kt)),s!==n?($(),g=t,t=xe()):(a=t,t=n),l--,t===n&&l===0&&f(Lt),t}function Ge(){var t,s;if(t=[],(s=V())!==n)for(;s!==n;)t.push(s),s=V();else t=n;return t}function V(){var t,s,u,h;return t=a,$(),(s=Le())!==n?($(),(u=He())===n&&(u=null),$(),i.charCodeAt(a)===41?(h=Y,a++):(h=n,l===0&&f(Qt)),h!==n?($(),g=t,t=be(s,u)):(a=t,t=n)):(a=t,t=n),t}function He(){var t,s,u,h,x,p,k,L;if(t=a,(s=W())!==n){for(u=[],h=a,x=$(),i.charCodeAt(a)===44?(p=m,a++):(p=n,l===0&&f(dt)),p===n&&(p=null),k=$(),(L=W())!==n?h=x=[x,p,k,L]:(a=h,h=n);h!==n;)u.push(h),h=a,x=$(),i.charCodeAt(a)===44?(p=m,a++):(p=n,l===0&&f(dt)),p===n&&(p=null),k=$(),(L=W())!==n?h=x=[x,p,k,L]:(a=h,h=n);g=t,t=Ae(s,u)}else a=t,t=n;return t}function W(){var t,s;return t=a,(s=Ke())===n&&(s=Qe())===n&&(s=Ve())===n&&(s=We()),s!==n&&(g=t,s=$e(s)),(t=s)===n&&(t=a,(s=Ze())!==n&&(g=t,s=Me(s)),t=s),t}function $(){var t,s;for(l++,t=[],ht.test(i.charAt(a))?(s=i.charAt(a),a++):(s=n,l===0&&f(yt));s!==n;)t.push(s),ht.test(i.charAt(a))?(s=i.charAt(a),a++):(s=n,l===0&&f(yt));return l--,s=n,l===0&&f(Vt),t}function Le(){var t,s,u;return l++,t=a,(s=Mt())!==n?(i.charCodeAt(a)===40?(u=w,a++):(u=n,l===0&&f(Zt)),u!==n?(g=t,t=Ce(s)):(a=t,t=n)):(a=t,t=n),l--,t===n&&(s=n,l===0&&f(Wt)),t}function Mt(){var t,s,u;if(l++,t=a,s=[],pt.test(i.charAt(a))?(u=i.charAt(a),a++):(u=n,l===0&&f(vt)),u!==n)for(;u!==n;)s.push(u),pt.test(i.charAt(a))?(u=i.charAt(a),a++):(u=n,l===0&&f(vt));else s=n;return s!==n&&(g=t,s=Fe()),l--,(t=s)===n&&(s=n,l===0&&f(te)),t}function Ke(){var t,s,u;return l++,t=a,$(),(s=F())!==n?(i.charCodeAt(a)===37?(u=E,a++):(u=n,l===0&&f(re)),u!==n?(g=t,t=ke(s)):(a=t,t=n)):(a=t,t=n),l--,t===n&&l===0&&f(ee),t}function Qe(){var t,s,u;return l++,t=a,$(),(s=F())!==n?(i.substr(a,2)===b?(u=b,a+=2):(u=n,l===0&&f(ae)),u!==n?(g=t,t=Oe(s)):(a=t,t=n)):(a=t,t=n),t===n&&(t=a,$(),(s=F())!==n?(i.substr(a,2)===nt?(u=nt,a+=2):(u=n,l===0&&f(oe)),u!==n?(g=t,t=Ee(s)):(a=t,t=n)):(a=t,t=n),t===n&&(t=a,$(),(s=F())!==n?(i.substr(a,2)===at?(u=at,a+=2):(u=n,l===0&&f(se)),u!==n?(g=t,t=Se(s)):(a=t,t=n)):(a=t,t=n),t===n&&(t=a,$(),(s=F())!==n?(i.substr(a,2)===ot?(u=ot,a+=2):(u=n,l===0&&f(ue)),u!==n?(g=t,t=_e(s)):(a=t,t=n)):(a=t,t=n),t===n&&(t=a,$(),(s=F())!==n?(i.substr(a,2)===st?(u=st,a+=2):(u=n,l===0&&f(ie)),u!==n?(g=t,t=Ne(s)):(a=t,t=n)):(a=t,t=n),t===n&&(t=a,$(),(s=F())!==n?(i.substr(a,2)===ut?(u=ut,a+=2):(u=n,l===0&&f(ce)),u!==n?(g=t,t=Re(s)):(a=t,t=n)):(a=t,t=n)))))),l--,t===n&&l===0&&f(ne),t}function Ve(){var t,s,u;return l++,t=a,(s=F())!==n?(i.substr(a,3)===it?(u=it,a+=3):(u=n,l===0&&f(fe)),u!==n?(g=t,t=je(s)):(a=t,t=n)):(a=t,t=n),t===n&&(t=a,(s=F())!==n?(i.substr(a,3)===ct?(u=ct,a+=3):(u=n,l===0&&f(he)),u!==n?(g=t,t=Je(s)):(a=t,t=n)):(a=t,t=n),t===n&&(t=a,(s=F())!==n?(i.substr(a,4)===lt?(u=lt,a+=4):(u=n,l===0&&f(pe)),u!==n?(g=t,t=qe(s)):(a=t,t=n)):(a=t,t=n),t===n&&(t=a,(s=F())!==n?(i.substr(a,4)===ft?(u=ft,a+=4):(u=n,l===0&&f(me)),u!==n?(g=t,t=Ie(s)):(a=t,t=n)):(a=t,t=n)))),l--,t===n&&(s=n,l===0&&f(le)),t}function We(){var t,s;return l++,t=a,$(),(s=F())!==n?(g=t,t=Pe(s)):(a=t,t=n),l--,t===n&&l===0&&f(ge),t}function Ze(){var t,s,u,h;if(l++,t=a,i.charCodeAt(a)===35?(s=Dt,a++):(s=n,l===0&&f(ye)),s!==n){if(u=[],mt.test(i.charAt(a))?(h=i.charAt(a),a++):(h=n,l===0&&f(wt)),h!==n)for(;h!==n;)u.push(h),mt.test(i.charAt(a))?(h=i.charAt(a),a++):(h=n,l===0&&f(wt));else u=n;u!==n?(g=t,t=Xe()):(a=t,t=n)}else a=t,t=n;return t===n&&(t=a,(s=V())!==n&&(g=t,s=Ye(s)),(t=s)===n&&(t=a,(s=Mt())!==n&&(g=t,s=ze()),t=s)),l--,t===n&&(s=n,l===0&&f(de)),t}function F(){var t,s,u,h,x,p,k;for(t=a,gt.test(i.charAt(a))?(i.charAt(a),a++):l===0&&f(xt),s=a,u=[],j.test(i.charAt(a))?(h=i.charAt(a),a++):(h=n,l===0&&f(J));h!==n;)u.push(h),j.test(i.charAt(a))?(h=i.charAt(a),a++):(h=n,l===0&&f(J));if(i.charCodeAt(a)===46?(h=Gt,a++):(h=n,l===0&&f(ve)),h!==n){if(x=[],j.test(i.charAt(a))?(p=i.charAt(a),a++):(p=n,l===0&&f(J)),p!==n)for(;p!==n;)x.push(p),j.test(i.charAt(a))?(p=i.charAt(a),a++):(p=n,l===0&&f(J));else x=n;x!==n?s=u=[u,h,x]:(a=s,s=n)}else a=s,s=n;if(s===n)if(s=[],j.test(i.charAt(a))?(u=i.charAt(a),a++):(u=n,l===0&&f(J)),u!==n)for(;u!==n;)s.push(u),j.test(i.charAt(a))?(u=i.charAt(a),a++):(u=n,l===0&&f(J));else s=n;if(s!==n){if(u=a,i.charCodeAt(a)===101?(h=Ht,a++):(h=n,l===0&&f(we)),h!==n){if(gt.test(i.charAt(a))?(x=i.charAt(a),a++):(x=n,l===0&&f(xt)),x===n&&(x=null),p=[],j.test(i.charAt(a))?(k=i.charAt(a),a++):(k=n,l===0&&f(J)),k!==n)for(;k!==n;)p.push(k),j.test(i.charAt(a))?(k=i.charAt(a),a++):(k=n,l===0&&f(J));else p=n;p!==n?u=h=[h,x,p]:(a=u,u=n)}else a=u,u=n;u===n&&(u=null),g=t,t=Be()}else a=t,t=n;return t}function tr(t,s){return t.map(function(u){return u[s]})}function er(t,s,u){return[t].concat(tr(s,u))}if((v=q())!==n&&a===i.length)return v;throw v!==n&&a<i.length&&f(Te()),Ue(Q,_<i.length?i.charAt(_):null,_<i.length?At(_,_+1):At(_,_))}return e(r,Error),r.prototype.format=function(i){var d="Error: "+this.message;if(this.location){var v,n=null;for(v=0;v<i.length;v++)if(i[v].source===this.location.source){n=i[v].text.split(/\r\n|\n|\r/g);break}var y=this.location.start,O=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(y):y,q=this.location.source+":"+O.line+":"+O.column;if(n){var I=this.location.end,Y=o("",O.line.toString().length," "),m=n[y.line-1],w=(y.line===I.line?I.column:m.length+1)-y.column||1;d+=`
 --> `+q+`
`+Y+` |
`+O.line+" | "+m+`
`+Y+" | "+o("",y.column-1," ")+o("",w,"^")}else d+=`
 at `+q}return d},r.buildMessage=function(i,d){var v={literal:function(m){return'"'+y(m.text)+'"'},class:function(m){var w=m.parts.map(function(E){return Array.isArray(E)?O(E[0])+"-"+O(E[1]):O(E)});return"["+(m.inverted?"^":"")+w.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function n(m){return m.charCodeAt(0).toString(16).toUpperCase()}function y(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+n(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+n(w)})}function O(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+n(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+n(w)})}function q(m){return v[m.type](m)}function I(m){var w,E,b=m.map(q);if(b.sort(),b.length>0){for(w=1,E=1;w<b.length;w++)b[w-1]!==b[w]&&(b[E]=b[w],E++);b.length=E}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function Y(m){return m?'"'+y(m)+'"':"end of input"}return"Expected "+I(i)+" but "+Y(d)+" found."},{SyntaxError:r,parse:c}},(Ft=Bt).exports&&(Ft.exports=kt());var br=Bt.exports;function Tt(e){if(!e||e.length===0)return null;if(typeof e=="string"){const o=Ot(e);return o&&o.length!==0?o:null}const r=e.map(o=>{if(!Number.isFinite(o.scale)||o.scale<=0)throw new M("effect:invalid-scale","scale must be finite and greater than 0",{stop:o});return{scale:o.scale,effects:Ot(o.value)}});r.sort((o,c)=>c.effects.length-o.effects.length);for(let o=0;o<r.length-1;o++){if(!vr(r[o].effects,r[o+1].effects))throw new M("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:r[o].effects,b:r[o+1].effects});wr(r[o].effects,r[o+1].effects)}return r.sort((o,c)=>c.scale-o.scale),r}function Ot(e){let r;if(!e)return[];try{r=br.parse(e)}catch(o){throw new M("effect:invalid-syntax","Invalid effect syntax",{value:e,error:o})}return r.map(o=>Ar(o))}function Ar(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return $r(e);case"opacity":return Mr(e);case"hue-rotate":return Cr(e);case"blur":return Fr(e);case"drop-shadow":return kr(e);case"bloom":return Or(e)}}catch(r){throw r.details.filter=e,r}throw new M("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function $r(e){let r=1;return z(e.parameters,1),e.parameters.length===1&&(r=S(e.parameters[0])),new U(e.name,r)}function Mr(e){let r=1;return z(e.parameters,1),e.parameters.length===1&&(r=S(e.parameters[0])),new Yt(r)}function Cr(e){let r=0;return z(e.parameters,1),e.parameters.length===1&&(r=jr(e.parameters[0])),new Pt(r)}function Fr(e){let r=0;return z(e.parameters,1),e.parameters.length===1&&(r=rt(e.parameters[0]),D(r,e.parameters[0])),new jt(r)}function kr(e){const r=[];let o=null;for(const c of e.parameters)if(c.type==="color"){if(r.length&&Object.freeze(r),o)throw new M("effect:type-error","Accepts only one color",{});o=Jr(c)}else{const i=rt(c);if(Object.isFrozen(r))throw new M("effect:type-error","<length> parameters not consecutive",{lengths:r});r.push(i),r.length===3&&D(i,c)}if(r.length<2||r.length>3)throw new M("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${r.length}}`,{lengths:r});return new qt(r[0],r[1],r[2]||0,o||Ut("black"))}function Or(e){let r=1,o=0,c=0;return z(e.parameters,3),e.parameters[0]&&(r=S(e.parameters[0])),e.parameters[1]&&(o=rt(e.parameters[1]),D(o,e.parameters[1])),e.parameters[2]&&(c=S(e.parameters[2])),new Nt(r,o,c)}function z(e,r){if(e.length>r)throw new M("effect:type-error",`Function supports up to ${r} parameters, Actual: ${e.length}`,{parameters:e})}function K(e){if(e.type==="color")return"<color>";if(e.unit){if(e.unit in et)return"<length>";if(e.unit in tt)return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function D(e,r){if(e<0)throw new M("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:r})}function Er(e){if(e.type!=="quantity"||e.unit!==null)throw new M("effect:type-error",`Expected <double>, Actual: ${K(e)}`,{term:e})}function Sr(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new M("effect:type-error",`Expected <double> or <percentage>, Actual: ${K(e)}`,{term:e})}const tt={deg:1,grad:.9,rad:180/Math.PI,turn:360};function _r(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&tt[e.unit]!=null))throw new M("effect:type-error",`Expected <angle>, Actual: ${K(e)}`,{term:e})}const et={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function Nr(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&et[e.unit]!=null))throw new M("effect:type-error",`Expected <length>, Actual: ${K(e)}`,{term:e})}function S(e){Sr(e);const r=e.value;return D(r,e),e.unit==="%"?.01*r:r}function Rr(e){return Er(e),D(e.value,e),e.value}function jr(e){return _r(e),e.value*tt[e.unit]||0}function rt(e){return Nr(e),e.value*et[e.unit]||0}function Jr(e){switch(e.colorType){case"hex":return or(e.value);case"named":return Ut(e.value);case"function":return Pr(e.value)}}function Ut(e){if(!sr(e))throw new M("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return ur(e)}const qr=/^rgba?/i,Ir=/^hsla?/i;function Pr(e){if(z(e.parameters,4),qr.test(e.name))return[S(e.parameters[0]),S(e.parameters[1]),S(e.parameters[2]),e.parameters[3]?S(e.parameters[3]):1];if(Ir.test(e.name))return ir(Rr(e.parameters[0]),S(e.parameters[1]),S(e.parameters[2]),e.parameters[3]?S(e.parameters[3]):1);throw new M("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function Xr(e,r,o){var c;try{return Br(e)}catch(i){(c=o==null?void 0:o.messages)==null||c.push(i)}return null}function Yr(e,r,o,c){try{const i=zr(e);nr(o,i,r)}catch(i){c.messages&&c.messages.push(i)}}function zr(e){const r=Tt(e);return r?xr(r)?r.map(o=>o.toJSON()):r.map(({scale:o,effects:c})=>({scale:o,value:c.map(i=>i.toJSON())})):null}function Br(e){if(!e||e.length===0)return null;if(Tr(e)){const r=[];for(const o of e)r.push({scale:o.scale,value:Et(o.value)});return r}return Et(e)}function Tr(e){const r=e[0];return!!r&&"scale"in r}function Et(e){if(!(e!=null&&e.length))return"";const r=[];for(const o of e){let c=[];switch(o.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":c=[R(o,"amount")];break;case"blur":c=[R(o,"radius","pt")];break;case"hue-rotate":c=[R(o,"angle","deg")];break;case"drop-shadow":c=[R(o,"xoffset","pt"),R(o,"yoffset","pt"),R(o,"blurRadius","pt"),Ur(o,"color")];break;case"bloom":c=[R(o,"strength"),R(o,"radius","pt"),R(o,"threshold")]}const i=`${o.type}(${c.filter(Boolean).join(" ")})`;Tt(i),r.push(i)}return r.join(" ")}function R(e,r,o){if(e[r]==null)throw new M("effect:missing-parameter",`Missing parameter '${r}' in ${e.type} effect`,{effect:e});return o?e[r]+o:""+e[r]}function Ur(e,r){if(e[r]==null)throw new M("effect:missing-parameter",`Missing parameter '${r}' in ${e.type} effect`,{effect:e});const o=e[r];return`rgba(${o[0]||0}, ${o[1]||0}, ${o[2]||0}, ${o[3]/255||0})`}const St={read:{reader:Xr},write:{allowNull:!0,writer:Yr}},Zr=e=>{let r=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return Z([Ct({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],r.prototype,"blendMode",void 0),Z([Ct({json:{read:!1,write:!1,origins:{"web-map":St,"portal-item":St}}})],r.prototype,"effect",void 0),r=Z([rr("esri.layers.mixins.BlendLayer")],r),r};export{Xr as a,Yr as b,wr as e,Et as i,Zr as n,vr as t,Tt as y};
