import{J as Or,l as Sr,m as jr,F as Er,j as zr}from"./SpatialReference-428523ee.js";import{e as fr}from"./mat3f64-e19cdcb8.js";import{j as Gr,P as Nr,h as pr,B as Lr,f as Br,C as Vr,c as Wr}from"./mat4-a6ac6b0f.js";import{e as w,o as j}from"./mat4f64-9a8384aa.js";import{d as Ir,M as gr,p as kr,q as qr,y as Hr,h as Ur,n as D,t as Yr,r as Jr,v as C,O as Z,S as rr,z as Dr,w as tr,G as Kr}from"./mathUtils-19b6edfc.js";import{n as er,u as nr,j as N,z as mr}from"./mat3-def297a7.js";import{H as Qr}from"./projection-41da473c.js";import{a as R,R as z}from"./computeTranslationToOriginAndRotation-3ac32984.js";import{n as G}from"./projectBuffer-af7b4ad9.js";import{t as or,o as Xr}from"./DoubleArray-d7e400b4.js";import{e as h,c as Zr}from"./subclass-f7409b1b.js";import{y as F,f as rt,r as tt}from"./JSONSupport-acf2865c.js";import"./typedArrayUtil-2af43698.js";import{s as q}from"./Error-21d1d076.js";import{v as yr,b as H,x as et}from"./quat-064ab1d0.js";import{e as K}from"./quatf64-81e039e4.js";import"./vec4f64-430e4feb.js";import{g as L,f as nt,u as hr}from"./meshVertexSpaceUtils-a98cf1bd.js";import{n as v,s as $r,i as ot,r as b}from"./vec3-10e9217f.js";import{h as at}from"./Extent-2b4578b8.js";import{i as $,T as A}from"./BufferView-6e304e0e.js";function P(r=Pr){return[r[0],r[1],r[2],r[3]]}function E(r,t,e=P()){return Ir(e,r),e[3]=t,e}function Jt(r,t=P()){const e=Gr(T,r);return Ar(t,gr(yr(t,e))),t}function ar(r,t,e=P()){return H(T,r,U(r)),H(ir,t,U(t)),et(T,ir,T),Ar(e,gr(yr(e,T)))}function Dt(r,t,e,n=P()){return E(kr,r,_),E(qr,t,sr),E(Hr,e,lr),ar(_,sr,_),ar(_,lr,n),n}function Kt(r){return r}function it(r){return r[3]}function U(r){return Ur(r[3])}function Ar(r,t){return r[3]=t,r}const Pr=[0,0,1,0],T=K(),ir=K();P();const _=P(),sr=P(),lr=P();var Y;let m=Y=class extends rt{constructor(r){super(r),this.translation=D(),this.rotationAxis=Yr(Pr),this.rotationAngle=0,this.scale=Jr(1,1,1)}get rotation(){return E(this.rotationAxis,this.rotationAngle)}set rotation(r){this.rotationAxis=C(r),this.rotationAngle=it(r)}get localMatrix(){const r=w();return H(cr,this.rotation,U(this.rotation)),Nr(r,cr,this.translation,this.scale),r}get localMatrixInverse(){return pr(w(),this.localMatrix)}applyLocal(r,t){return Z(t,r,this.localMatrix)}applyLocalInverse(r,t){return Z(t,r,this.localMatrixInverse)}equals(r){return this===r||r!=null&&Lr(this.localMatrix,r.localMatrix)}clone(){const r={translation:C(this.translation),rotationAxis:C(this.rotationAxis),rotationAngle:this.rotationAngle,scale:C(this.scale)};return new Y(r)}};h([F({type:[Number],nonNullable:!0,json:{write:!0}})],m.prototype,"translation",void 0),h([F({type:[Number],nonNullable:!0,json:{write:!0}})],m.prototype,"rotationAxis",void 0),h([F({type:Number,nonNullable:!0,json:{write:!0}})],m.prototype,"rotationAngle",void 0),h([F({type:[Number],nonNullable:!0,json:{write:!0}})],m.prototype,"scale",void 0),h([F()],m.prototype,"rotation",null),h([F()],m.prototype,"localMatrix",null),h([F()],m.prototype,"localMatrixInverse",null),m=Y=h([Zr("esri.geometry.support.MeshTransform")],m);const cr=K(),ur=m;function xr(r,t){return r.isGeographic||r.isWebMercator&&(t??!0)}function Fr(r,t){switch(r.type){case"georeferenced":return t.isGeographic;case"local":return t.isGeographic||t.isWebMercator}}function Qt(r,t,e,n){if(n!==void 0){tt(q.getLogger(r),"option: geographic",{replacement:"use mesh vertexSpace and spatial reference to control how operations are performed",version:"4.29",warnOnce:!0});const o=t.type==="local";if(!L(t)||n===o)return e.isGeographic||e.isWebMercator&&n;q.getLogger(r).warnOnce(`Specifying the 'geographic' parameter (${n}) for a Mesh vertex space of type "${t.type}" is not supported. This parameter will be ignored.`)}return Fr(t,e)}const B=()=>q.getLogger("esri.geometry.support.meshUtils.normalProjection");function st(r,t,e,n,o){return W(n)?(V(y.TO_PCPF,$.fromTypedArray(r),A.fromTypedArray(t),A.fromTypedArray(e),n,$.fromTypedArray(o)),o):(B().error("Cannot convert spatial reference to PCPF"),o)}function lt(r,t,e,n,o){return W(n)?(V(y.FROM_PCPF,$.fromTypedArray(r),A.fromTypedArray(t),A.fromTypedArray(e),n,$.fromTypedArray(o)),o):(B().error("Cannot convert to spatial reference from PCPF"),o)}function ct(r,t,e){return G(r,t,0,e,R(t),0,r.length/3),e}function ut(r,t,e){return G(r,R(e),0,t,e,0,r.length/3),t}function ft(r,t,e){return N(u,e),v(t,r,u),mr(u)||$r(t,t),t}function pt(r,t,e){if(N(u,e),v(t,r,u,4),mr(u)||$r(t,t,4),r!==t)for(let n=3;n<r.length;n+=4)t[n]=r[n];return t}function gt(r,t,e,n,o){if(!W(n))return B().error("Cannot convert spatial reference to PCPF"),o;V(y.TO_PCPF,$.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),A.fromTypedArray(t),A.fromTypedArray(e),n,$.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT));for(let a=3;a<r.length;a+=4)o[a]=r[a];return o}function mt(r,t,e,n,o){if(!W(n))return B().error("Cannot convert to spatial reference from PCPF"),o;V(y.FROM_PCPF,$.fromTypedArray(r,16),A.fromTypedArray(t),A.fromTypedArray(e),n,$.fromTypedArray(o,16));for(let a=3;a<r.length;a+=4)o[a]=r[a];return o}function V(r,t,e,n,o,a){if(!t)return;const l=e.count,c=R(o);if(dr(o))for(let i=0;i<l;i++)n.getVec(i,O),t.getVec(i,g),z(c,O,S,c),er(u,S),r===y.FROM_PCPF&&nr(u,u),rr(g,g,u),a.setVec(i,g);else for(let i=0;i<l;i++){n.getVec(i,O),t.getVec(i,g),z(c,O,S,c),er(u,S);const s=at(e.get(i,1));let f=Math.cos(s);r===y.TO_PCPF&&(f=1/f),u[0]*=f,u[1]*=f,u[2]*=f,u[3]*=f,u[4]*=f,u[5]*=f,r===y.FROM_PCPF&&nr(u,u),rr(g,g,u),Dr(g,g),a.setVec(i,g)}return a}function W(r){return dr(r)||yt(r)}function dr(r){return r.isWGS84||Or(r)||Sr(r)||jr(r)}function yt(r){return r.isWebMercator}var y;(function(r){r[r.TO_PCPF=0]="TO_PCPF",r[r.FROM_PCPF=1]="FROM_PCPF"})(y||(y={}));const O=D(),g=D(),S=w(),u=fr();function Q(r,t,e){return xr(t.spatialReference,e==null?void 0:e.geographic)?X(r,t,!1,e):Pt(r,t,e)}function vr(r,t=j){const{position:e,normal:n,tangent:o}=r;return{position:b(new Float64Array(e.length),e,t),normal:n!=null?ft(n,new Float32Array(n.length),t):null,tangent:o!=null?pt(o,new Float32Array(o.length),t):null}}function Mr(r,t,e,n){const{position:o,normal:a,tangent:l}=r;if(!L(t))return{position:o,normal:a,tangent:l};const c=hr(t,n);return Q(vr(r,e==null?void 0:e.localMatrix),c,{geographic:t.type==="local"})}function ht(r,t,e){const n=nt(t,e),o=t.spatialReference,a=L(n);if(!a)return{vertexAttributes:Q(r,t,e),vertexSpace:n,transform:null};const{position:l,normal:c,tangent:i}=r,s=Fr(n,o);switch(n.type){case"georeferenced":return s?{vertexAttributes:X(r,t,a,e),vertexSpace:n,transform:null}:{vertexAttributes:{position:l,normal:c,tangent:i},vertexSpace:n,transform:new ur};case"local":return{vertexAttributes:{position:l,normal:c,tangent:i},vertexSpace:n,transform:new ur}}}function J(r,t,e){return xr(t.spatialReference,e==null?void 0:e.geographic)?wr(r,t,e):Tr(r,t,e)}function $t(r,t,e,n,o){if(!L(t))return J(r,n,o);const{spatialReference:a}=n,l=Mr(r,t,e,a);return n.equals(hr(t,a))?Tr(l,n,o):J(l,n,o)}function At({positions:r,transform:t,vertexSpace:e,inSpatialReference:n,outSpatialReference:o,outPositions:a,localMode:l}){const c=e.origin??tr,i=e.origin!=null?(t==null?void 0:t.localMatrix)??j:j;if(e.type==="georeferenced"){const p=a??or(r.length);if(Vr(i,j)?Xr(p,r):b(p,r,i),!Kr(c,tr)){const[k,Cr,_r]=c;for(let M=0;M<p.length;M+=3)p[M]+=k,p[M+1]+=Cr,p[M+2]+=_r}return G(p,n,0,p,o,0,p.length/3),p}let s=n;const f=R(n);s=o.isWebMercator&&l||!Qr(n,f)?s:f,z(n,c,d,s),Wr(d,d,i);const x=a??or(r.length);return b(x,r,d),G(x,s,0,x,o,0,x.length/3),x}function Pt(r,t,e){const n=new Float64Array(r.position.length),o=r.position,a=t.x,l=t.y,c=t.z??0,i=I(e?e.unit:null,t.spatialReference);for(let s=0;s<o.length;s+=3)n[s]=o[s]*i+a,n[s+1]=o[s+1]*i+l,n[s+2]=o[s+2]*i+c;return{position:n,normal:r.normal,tangent:r.tangent}}function X(r,t,e,n){const o=t.spatialReference,a=br(t,n,d),l=new Float64Array(r.position.length),c=xt(r.position,a,o,l),i=N(Rr,a),s=Ft(c,l,r.normal,i,o),f=dt(c,l,r.tangent,i,o);if(e){const{x,y:p,z:k}=t;ot(c,c,[-x,-p,-(k??0)])}return{position:c,normal:s,tangent:f}}function xt(r,t,e,n){b(n,r,t);const o=new Float64Array(r.length);return ut(n,o,e)}function Ft(r,t,e,n,o){if(e==null)return null;const a=new Float32Array(e.length);return v(a,e,n),lt(a,r,t,o,a),a}function dt(r,t,e,n,o){if(e==null)return null;const a=new Float32Array(e.length);v(a,e,n,4);for(let l=3;l<a.length;l+=4)a[l]=e[l];return mt(a,r,t,o,a),a}function Tr(r,t,e){const n=new Float64Array(r.position.length),o=r.position,a=t.x,l=t.y,c=t.z??0,i=I(e?e.unit:null,t.spatialReference);for(let s=0;s<o.length;s+=3)n[s]=(o[s]-a)/i,n[s+1]=(o[s+1]-l)/i,n[s+2]=(o[s+2]-c)/i;return{position:n,normal:r.normal,tangent:r.tangent}}function wr(r,t,e){const n=t.spatialReference;br(t,e,d);const o=pr(wt,d),a=new Float64Array(r.position.length),l=vt(r.position,n,o,a),c=N(Rr,o);return{position:l,normal:Mt(r.normal,r.position,a,n,c),tangent:Tt(r.tangent,r.position,a,n,c)}}function br(r,t,e){z(r.spatialReference,[r.x,r.y,r.z??0],e,R(r.spatialReference));const n=I(t?t.unit:null,r.spatialReference);return Br(e,e,[n,n,n]),e}function vt(r,t,e,n){const o=ct(r,t,n),a=new Float64Array(o.length);return b(a,o,e),a}function Mt(r,t,e,n,o){if(r==null)return null;const a=st(r,t,e,n,new Float32Array(r.length));return v(a,a,o),a}function Tt(r,t,e,n,o){if(r==null)return null;const a=gt(r,t,e,n,new Float32Array(r.length));return v(a,a,o,4),a}function I(r,t){if(r==null)return 1;const e=Er(t);return 1/zr(e,"meters",r)}const d=w(),wt=w(),Rr=fr(),Xt=Object.freeze(Object.defineProperty({__proto__:null,applyTransform:vr,georeference:Q,georeferenceApplyTransform:Mr,georeferenceByTransform:ht,georeferenceGlobal:X,getUnitScale:I,project:At,ungeoreference:J,ungeoreferenceByTransform:$t,ungeoreferenceGlobal:wr},Symbol.toStringTag,{value:"Module"}));export{U as A,$t as C,ut as E,At as G,X as I,ct as O,Mr as P,wr as Q,ht as V,I as _,lt as a,P as b,Qt as c,ur as d,mt as e,vr as f,Xt as g,gt as h,st as j,Jt as k,Dt as w,Kt as y};
