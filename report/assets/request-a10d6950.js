import{c as $,a as I,s as qe,b as xe}from"./Error-21d1d076.js";import{q as Oe,h as O}from"./typedArrayUtil-2af43698.js";import{g as ne}from"./JSONSupport-acf2865c.js";import{f as fe,m as ve,b as Ce,a as he}from"./promiseUtils-1d963c7c.js";const ke="modulepreload",Ue=function(e,t){return new URL(e,t).href},se={},de=function(t,r,n){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(o=>{if(o=Ue(o,n),o in se)return;se[o]=!0;const a=o.endsWith(".css"),l=a?'[rel="stylesheet"]':"";if(!!n)for(let c=s.length-1;c>=0;c--){const p=s[c];if(p.href===o&&(!a||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${l}`))return;const i=document.createElement("link");if(i.rel=a?"stylesheet":ke,a||(i.as="script",i.crossOrigin=""),i.href=o,document.head.appendChild(i),a)return new Promise((c,p)=>{i.addEventListener("load",c),i.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t())},Se=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,Le={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function oe(e){const t=e==null?void 0:e.match(Se);if(!t)return null;const[,r,n,s]=t;if(!r)return null;let o=null,a=null,l=null;const{devext:u,qaext:i,www:c}=Le;if(n)if(o=r,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:a,portalHostname:l}=u);break;case"qa":({customBaseUrl:a,portalHostname:l}=i);break;default:return null}else({customBaseUrl:a,portalHostname:l}=c);else switch(r.toLowerCase()){case"devext":({customBaseUrl:a,portalHostname:l}=u);break;case"qaext":({customBaseUrl:a,portalHostname:l}=i);break;case"www":({customBaseUrl:a,portalHostname:l}=c);break;default:return null}return{customBaseUrl:a,isPortal:!1,portalHostname:l,urlKey:o}}function Te(e){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(e)}function Ee(e){const t=atob(e),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r.buffer}function Re(e){const t=new Uint8Array(e);let r="";for(let n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return btoa(r)}const Ae=()=>qe.getLogger("esri.core.urlUtils"),U=$.request,ae="esri/config: esriConfig.request.proxyUrl is not set.",pe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,me=/^\s*http:/i,Pe=/^\s*https:/i,Ie=/^\s*file:/i,je=/:\d+$/,De=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,_e=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),He=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class C{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(_e);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(He),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}}const P={},Be=new C($.applicationUrl);let h=Be;const Ne=Fe();let G=Ne;const ye=()=>h,At=()=>G;function Fe(){const e=h.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${h.scheme}://${h.host}${h.port!=null?`:${h.port}`:""}`}${t}`}function v(e){if(!e)return null;const t={path:null,query:null},r=new C(e),n=e.indexOf("?");return r.query===null?t.path=e:(t.path=e.substring(0,n),t.query=V(r.query)),r.fragment&&(t.hash=r.fragment,r.query===null&&(t.path=t.path.substring(0,t.path.length-(r.fragment.length+1)))),t}function V(e){const t=e.split("&"),r={};for(const n of t){if(!n)continue;const s=n.indexOf("=");let o,a;s<0?(o=decodeURIComponent(n),a=""):(o=decodeURIComponent(n.slice(0,s)),a=decodeURIComponent(n.slice(s+1)));let l=r[o];typeof l=="string"&&(l=r[o]=[l]),Array.isArray(l)?l.push(a):r[o]=a}return r}function T(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(t(r,e[r]))).join("&"):Object.keys(e).map(r=>{const n=e[r];if(n==null)return"";const s=encodeURIComponent(r)+"=",o=t==null?void 0:t[r];return o?s+encodeURIComponent(o(n)):Array.isArray(n)?n.map(a=>ne(a)?s+encodeURIComponent(JSON.stringify(a)):s+encodeURIComponent(a)).join("&"):ne(n)?s+encodeURIComponent(JSON.stringify(n)):s+encodeURIComponent(n)}).filter(r=>r).join("&"):""}function Me(e=!1){let t,r=U.proxyUrl;if(typeof e=="string"){t=Xe(e);const n=N(e);n&&(r=n.proxyUrl)}else t=!!e;if(!r)throw Ae().warn(ae),new I("urlUtils:proxy-not-set",ae);return t&&z()&&(r=re(r)),v(r)}function Pt(e){const t=N(e);let r,n;if(t){const s=Q(t.proxyUrl);r=s.path,n=s.query?V(s.query):null}if(r){const s=v(e);e=r+"?"+s.path;const o=T({...n,...s.query});o&&(e=`${e}?${o}`)}return e}const S={path:"",query:""};function Q(e){const t=e.indexOf("?");return t!==-1?(S.path=e.slice(0,t),S.query=e.slice(t+1)):(S.path=e,S.query=null),S}function ge(e){return e=(e=_(e=rt(e=Q(e).path),!0)).toLowerCase()}function We(e){const t={proxyUrl:e.proxyUrl,urlPrefix:ge(e.urlPrefix)},r=U.proxyRules,n=t.urlPrefix;let s=r.length;for(let o=0;o<r.length;o++){const a=r[o].urlPrefix;if(n.indexOf(a)===0){if(n.length===a.length)return-1;s=o;break}a.indexOf(n)===0&&(s=o+1)}return r.splice(s,0,t),s}function N(e){const t=U.proxyRules,r=ge(e);for(let n=0;n<t.length;n++)if(r.indexOf(t[n].urlPrefix)===0)return t[n]}function It(e,t){if(!e||!t)return!1;e=j(e),t=j(t);const r=oe(e),n=oe(t);return r!=null&&n!=null?r.portalHostname===n.portalHostname:r==null&&n==null&&E(e,t,!0)}function jt(e,t){return e=j(e),t=j(t),_(e)===_(t)}function j(e){const t=(e=L(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function ze(e){const t=n=>n==null||n instanceof RegExp&&n.test(e)||typeof n=="string"&&e.startsWith(n),r=U.interceptors;if(r){for(const n of r)if(Array.isArray(n.urls)){if(n.urls.some(t))return n}else if(t(n.urls))return n}return null}function E(e,t,r=!1){if(!e||!t)return!1;const n=J(e),s=J(t);return!(!r&&n.scheme!==s.scheme)&&n.host!=null&&s.host!=null&&n.host.toLowerCase()===s.host.toLowerCase()&&n.port===s.port}function X(e){if(typeof e=="string"){if(!R(e))return!0;e=J(e)}if(E(e,h))return!0;const t=U.trustedServers||[];for(let r=0;r<t.length;r++){const n=Je(t[r]);for(let s=0;s<n.length;s++)if(E(e,n[s]))return!0}return!1}function Je(e){return P[e]||(te(e)||q(e)?P[e]=[new C(Y(e))]:P[e]=[new C(`http://${e}`),new C(`https://${e}`)]),P[e]}function Y(e,t=G,r){return q(e)?r&&r.preserveProtocolRelative?e:h.scheme==="http"&&h.authority===y(e).slice(2)?`http:${e}`:`https:${e}`:te(e)?e:Ke(e[0]==="/"?tt(t):t,e)}function Dt(e,t=G,r){if(e==null||!R(e))return e;const n=L(e),s=n.toLowerCase(),o=L(t).toLowerCase().replace(/\/+$/,""),a=r?L(r).toLowerCase().replace(/\/+$/,""):null;if(a&&o.indexOf(a)!==0)return e;const l=(p,f,g)=>(g=p.indexOf(f,g))===-1?p.length:g;let u=l(s,"/",s.indexOf("//")+2),i=-1;for(;s.slice(0,u+1)===o.slice(0,u)+"/"&&(i=u+1,u!==s.length);)u=l(s,"/",u+1);if(i===-1||a&&i<a.length)return e;e=n.slice(i);const c=o.slice(i-1).replaceAll(/[^/]+/g,"").length;if(c>0)for(let p=0;p<c;p++)e=`../${e}`;else e=`./${e}`;return e}function L(e){return e=ot(e=st(e=nt(e=Y(e=e.trim()))))}function Ke(...e){const t=e.filter(Oe);if(!(t!=null&&t.length))return;const r=[];if(R(t[0])){const s=t[0],o=s.indexOf("//");o!==-1&&(r.push(s.slice(0,o+1)),Ze(t[0])&&(r[0]+="/"),t[0]=s.slice(o+2))}else t[0][0]==="/"&&r.push("");const n=t.reduce((s,o)=>o?s.concat(o.split("/")):s,[]);for(let s=0;s<n.length;s++){const o=n[s];o===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!o&&s===n.length-1||o&&(o!=="."||r.length===0))&&r.push(o)}return r.join("/")}function y(e,t=!1){if(e==null||Z(e)||ee(e))return null;let r=e.indexOf("://");if(r===-1&&q(e))r=2;else{if(r===-1)return null;r+=3}const n=e.indexOf("/",r);return n!==-1&&(e=e.slice(0,n)),t&&(e=_(e,!0)),e}function R(e){return q(e)||te(e)}function Z(e){return e!=null&&e.slice(0,5)==="blob:"}function ee(e){return e!=null&&e.slice(0,5)==="data:"}function Ge(e){const t=D(e);return t&&t.isBase64?Ee(t.data):null}function _t(e){return Re(e).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const Ve=/^data:(.*?)(;base64)?,(.*)$/;function D(e){const t=e.match(Ve);if(!t)return null;const[,r,n,s]=t;return{mediaType:r,isBase64:!!n,data:s}}function Ht(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}async function Bt(e){return(await fetch(e)).blob()}function Nt(e){const t=Ge(e);if(!t)return null;const r=D(e);return new Blob([t],{type:r.mediaType})}function Ft(e,t){Qe(e,t)}function Qe(e,t){if(!e)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const n=URL.createObjectURL(e);return r.download=t,r.href=n,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n),!0}function q(e){return e!=null&&e[0]==="/"&&e[1]==="/"}function te(e){return e!=null&&pe.test(e)}function Xe(e){return e!=null&&Pe.test(e)||h.scheme==="https"&&q(e)}function Ye(e){return e!=null&&me.test(e)||h.scheme==="http"&&q(e)}function Ze(e){return e!=null&&Ie.test(e)}function re(e){return q(e)?`https:${e}`:e.replace(me,"https:")}function et(){return h.scheme==="http"}function z(){return h.scheme==="https"}function _(e,t=!1){return q(e)?e.slice(2):(e=e.replace(pe,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function tt(e){const t=e.indexOf("//"),r=e.indexOf("/",t+2);return r===-1?e:e.slice(0,r)}function Mt(e){let t=0;if(R(e)){const n=e.indexOf("//");n!==-1&&(t=n+2)}const r=e.lastIndexOf("/");return r<t?e:e.slice(0,r+1)}function Wt(e,t){if(!e)return"";const r=v(e).path.replace(/\/+$/,""),n=r.substring(r.lastIndexOf("/")+1);if(!(t!=null&&t.length))return n;const s=new RegExp(`.(${t.join("|")})$`,"ig");return n.replace(s,"")}function rt(e){return e.endsWith("/")?e:`${e}/`}function zt(e){return e.replace(/\/+$/,"")}function nt(e){if(/^https?:\/\//i.test(e)){const t=Q(e);e=(e=t.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function st(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function ot(e){const t=U.httpsDomains;if(!Ye(e))return e;const r=e.indexOf("/",7);let n;if(n=r===-1?e:e.slice(0,r),n=n.toLowerCase().slice(7),je.test(n)){if(!n.endsWith(":80"))return e;n=n.slice(0,-3),e=e.replace(":80","")}return et()&&n===h.authority&&!De.test(e)||(z()&&n===h.authority||t&&t.some(s=>n===s||n.endsWith(`.${s}`))||z()&&!N(e))&&(e=re(e)),e}function Jt(e,t,r){if(!(t&&r&&e&&R(e)))return e;const n=e.indexOf("//"),s=e.indexOf("/",n+2),o=e.indexOf(":",n+2),a=Math.min(s<0?e.length:s,o<0?e.length:o);return e.slice(n+2,a).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,n+2)}${r}${e.slice(a)}`}function J(e){return typeof e=="string"?new C(Y(e)):(e.scheme||(e.scheme=h.scheme),e)}function Kt(e){return it.test(e)}function Gt(e,t){const r=v(e),n=Object.keys(r.query||{});return n.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${n.join(", ")}.`),r.path}function at(e,t,r){const n=v(e),s=n.query||{};return s[t]=String(r),`${n.path}?${T(s)}`}function W(e,t){if(!t)return e;const r=v(e),n=r.query||{};for(const[o,a]of Object.entries(t))a!=null&&(n[o]=a);const s=T(n);return s?`${r.path}?${s}`:r.path}function Vt(e){if(e==null)return null;const t=e.match(we);return t?t[2]:null}function Qt(e){if(e==null)return null;const t=e.match(we);return t?{path:t[1],extension:t[2]}:{path:e,extension:null}}async function Xt(e){return typeof e=="string"?D(e)??{data:e}:new Promise((t,r)=>{const n=new FileReader;n.readAsDataURL(e),n.onload=()=>t(D(n.result)),n.onerror=s=>r(s)})}const we=/([^.]*)\.([^\/]*)$/,it=/(^data:image\/svg|\.svg$)/i;Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const lt="4.29";let d,ut=lt;ut="4.29.3";function Yt(e){d=e}function Zt(e){const t=d==null?void 0:d.findCredential(e);return t!=null&&t.token?at(e,"token",t.token):e}O("host-webworker");const ct=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function ft(e){const t=y(e,!0);return!!t&&t.endsWith(".arcgis.com")&&!ct.has(t)&&!e.endsWith("/sharing/rest/generateToken")}function ht(e,t,r=!1,n){return new Promise((s,o)=>{if(fe(n))return void o(ie());let a=()=>{i(),o(new Error(`Unable to load ${t}`))},l=()=>{const c=e;i(),s(c)},u=()=>{if(!e)return;const c=e;i(),c.src="",o(ie())};const i=()=>{O("esri-image-decode")||(e.removeEventListener("error",a),e.removeEventListener("load",l)),a=null,l=null,e=null,n!=null&&n.removeEventListener("abort",u),u=null,r&&URL.revokeObjectURL(t)};n!=null&&n.addEventListener("abort",u),O("esri-image-decode")?e.decode().then(l,a):(e.addEventListener("error",a),e.addEventListener("load",l))})}function ie(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}const dt="Timeout exceeded";function pt(){return new Error(dt)}function mt(e){$.request.crossOriginNoCorsDomains||($.request.crossOriginNoCorsDomains={});const t=$.request.crossOriginNoCorsDomains;for(let r of e)r=r.toLowerCase(),/^https?:\/\//.test(r)?t[y(r)??""]=0:(t[y("http://"+r)??""]=0,t[y("https://"+r)??""]=0)}function yt(e){const t=$.request.crossOriginNoCorsDomains;if(t){let r=y(e);if(r)return r=r.toLowerCase(),!E(r,ye())&&t[r]<Date.now()-36e5}return!1}async function gt(e){var s;const t=$.request.crossOriginNoCorsDomains,r=y(e);t&&r&&(t[r.toLowerCase()]=Date.now());const n=v(e);e=n.path,((s=n.query)==null?void 0:s.f)==="json"&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}async function w(e,t){var i;e instanceof URL&&(e=e.toString()),(t==null?void 0:t.query)instanceof URLSearchParams&&(t.query=V(t.query.toString().replaceAll("+"," ")));const r=ee(e),n=Z(e);n||r||(e=L(e));const s={url:e,requestOptions:{...t}};let o=ze(e);if(o){const c=await Ct(o,s);if(c!=null)return{data:c,getAllHeaders:k,getHeader:k,httpStatus:200,requestOptions:s.requestOptions,url:s.url};o.after||o.error||(o=null)}if(e=s.url,(t=s.requestOptions).responseType==="image"&&(O("host-webworker")||O("host-node")))throw b("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(t.method==="head"){if(t.body)throw b("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||n)throw b("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await xt(),H)return H.execute(e,t);const a=new AbortController;ve(t,()=>a.abort());const l={controller:a,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:o,params:s,redoRequest:!1,useIdentity:m.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},u=await Ut(l);return(i=o==null?void 0:o.after)==null||i.call(o,u),u}let H;const m=$.request,$e="FormData"in globalThis,wt=new Set([499,498,403,401]),$t=new Set(["COM_0056","COM_0057","SB_0008"]),bt=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],k=()=>null,B=Symbol();function qt(e){const t=y(e);t&&!w._corsServers.includes(t)&&w._corsServers.push(t)}function le(e){const t=y(e);return!t||t.endsWith(".arcgis.com")||w._corsServers.includes(t)||X(t)}function b(e,t,r,n){let s="Error";const o={url:r.url,requestOptions:r.requestOptions,getAllHeaders:k,getHeader:k,ssl:!1};if(t instanceof I)return t.details?(t.details=xe(t.details),t.details.url=r.url,t.details.requestOptions=r.requestOptions):t.details=o,t;if(t){const a=n&&(()=>Array.from(n.headers)),l=n&&(c=>n.headers.get(c)),u=n==null?void 0:n.status,i=t.message;i&&(s=i),a&&l&&(o.getAllHeaders=a,o.getHeader=l),o.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||u||0,o.subCode=t.subcode,o.messageCode=t.messageCode,typeof t.details=="string"?o.messages=[t.details]:o.messages=t.details,o.raw=B in t?t[B]:t}return Ce(t)?he():new I(e,s,o)}async function xt(){O("host-webworker")&&!H&&(H=await de(()=>import("./request-fb8faa76.js"),["./request-fb8faa76.js","./Error-21d1d076.js","./typedArrayUtil-2af43698.js"],import.meta.url))}async function K(){d||await de(()=>import("./IdentityManager-b321fa71.js"),["./IdentityManager-b321fa71.js","./subclass-f7409b1b.js","./typedArrayUtil-2af43698.js","./Error-21d1d076.js","./promiseUtils-1d963c7c.js","./Evented-b5127116.js","./JSONSupport-acf2865c.js","./time-0817624a.js","./intl-fe039018.js","./date-7940da18.js","./jsonMap-5ba4a9c2.js","./locale-bde6d0f6.js","./datetime-7e00d9ef.js","./messages-2d262041.js","./assets-6fd92e57.js","./jsxFactory-605eab60.js","./Promise-ec74e14b.js","./reactiveUtils-e7d9f86e.js","./Collection-aa6ef54b.js","./SimpleObservable-ae589a25.js","./uuid-709b6c67.js","./cast-e7a2f9aa.js","./substitute-c91ec889.js"],import.meta.url)}async function Ot(e){var l;const t=e.params.url,r=e.params.requestOptions,n=e.controller.signal,s=r.body;let o=null,a=null;if($e&&"HTMLFormElement"in globalThis&&(s instanceof FormData?o=s:s instanceof HTMLFormElement&&(o=new FormData(s))),typeof s=="string"&&(a=s),e.fetchOptions={cache:r.cacheBust?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:m.priority,redirect:"follow",signal:n},(o||a)&&(e.fetchOptions.body=o||a),r.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||(l=r.query)!=null&&l.token||o!=null&&o.get("token")),!e.hasToken&&$.apiKey&&ft(t)&&(r.query||(r.query={}),r.query.token=$.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!be(t)&&!fe(n)){let u;r.authMode==="immediate"?(await K(),u=await d.getCredential(t,{signal:n}),e.credential=u):r.authMode==="no-prompt"?(await K(),u=await d.getCredential(t,{prompt:!1,signal:n}).catch(()=>{}),e.credential=u):d&&(u=d.findCredential(t)),u&&(e.credentialToken=u.token,e.useSSL=!!u.ssl)}}function be(e){return bt.some(t=>t.test(e))}async function vt(e){let t=e.params.url;const r=e.params.requestOptions,n=e.fetchOptions??{},s=Z(t)||ee(t),o=r.responseType||"json",a=s?0:r.timeout!=null?r.timeout:m.timeout;let l=!1;if(!s){e.useSSL&&(t=re(t));let f={...r.query};e.credentialToken&&(f.token=e.credentialToken);let g=T(f);O("esri-url-encodes-apostrophe")&&(g=g.replaceAll("'","%27"));const F=t.length+1+g.length;let M;l=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||F>m.maxUrlLength;const A=r.useProxy||!!N(t);if(A){const x=Me(t);M=x.path,!l&&M.length+1+F>m.maxUrlLength&&(l=!0),x.query&&(f={...x.query,...f})}if(n.method==="HEAD"&&(l||A)){if(l)throw F>m.maxUrlLength?b("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):b("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(A)throw b("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(l?(n.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?t=W(t,f):(n.body=T(f),n.headers||(n.headers={}),n.headers["Content-Type"]="application/x-www-form-urlencoded")):t=W(t,f),A&&(e.useProxy=!0,t=`${M}?${t}`),f.token&&$e&&n.body instanceof FormData&&!Te(t)&&n.body.set("token",f.token),r.hasOwnProperty("withCredentials"))e.withCredentials=r.withCredentials;else if(!E(t,ye())){if(X(t))e.withCredentials=!0;else if(d){const x=d.findServerInfo(t);x!=null&&x.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(n.credentials="include",yt(t)&&await gt(l?W(t,f):t))}let u,i,c=0,p=!1;a>0&&(c=setTimeout(()=>{p=!0,e.controller.abort()},a));try{if(r.responseType==="native-request-init")i=n,i.url=t;else if(r.responseType!=="image"||n.cache!=="default"||n.method!=="GET"||l||kt(r.headers)||!s&&!e.useProxy&&m.proxyUrl&&!le(t)){if(w._beforeFetch&&await w._beforeFetch(t,n),u=await fetch(t,n),w._afterFetch&&await w._afterFetch(u),e.useProxy||qt(t),r.responseType==="native")i=u;else if(n.method!=="HEAD")if(u.ok){switch(o){case"array-buffer":i=await u.arrayBuffer();break;case"blob":case"image":i=await u.blob();break;default:i=await u.text()}if(c&&(clearTimeout(c),c=0),o==="json"||o==="xml"||o==="document")if(i)switch(o){case"json":i=JSON.parse(i);break;case"xml":i=ue(i,"application/xml");break;case"document":i=ue(i,"text/html")}else i=null;if(i){if(o==="array-buffer"||o==="blob"){const f=u.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&i[o==="blob"?"size":"byteLength"]<=750)try{const g=await new Response(i).json();g.error&&(i=g)}catch{}}o==="image"&&i instanceof Blob&&(i=await ce(URL.createObjectURL(i),e,!0))}}else{i=await u.text();try{i=JSON.parse(i)}catch{}}}else i=await ce(t,e)}catch(f){if(f.name==="AbortError")throw p?pt():he("Request canceled");if(!(!u&&f instanceof TypeError&&m.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||e.useProxy||le(t))throw f;e.redoRequest=!0,We({proxyUrl:m.proxyUrl,urlPrefix:y(t)??""})}finally{c&&clearTimeout(c)}return[u,i]}async function Ct(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let r,n;try{n=await e.before(t)}catch(s){r=b("request:interceptor",s,t)}if((n instanceof Error||n instanceof I)&&(r=b("request:interceptor",n,t)),r)throw e.error&&e.error(r),r;return n}}function kt(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function ue(e,t){let r;try{r=new DOMParser().parseFromString(e,t)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function Ut(e){var o,a;let t,r;await Ot(e);try{do[t,r]=await vt(e);while(!await St(e,t,r))}catch(l){const u=b("request:server",l,e.params,t);throw u.details.ssl=e.useSSL,(o=e.interceptor)!=null&&o.error&&e.interceptor.error(u),u}const n=e.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(n)){if(!e.hasToken&&!e.credentialToken&&((a=r.user)!=null&&a.username)&&!X(n)){const l=y(n,!0);l&&m.trustedServers.push(l)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&mt(r.authorizedCrossOriginNoCorsDomains)}const s=e.credential;if(s&&d){const l=d.findServerInfo(s.server);let u=l==null?void 0:l.owningSystemUrl;if(u){u=u.replace(/\/?$/,"/sharing");const i=d.findCredential(u,s.userId);i&&d._getIdenticalSvcIdx(u,i)===-1&&i.resources.unshift(u)}}return{data:r,getAllHeaders:t?()=>Array.from(t.headers):k,getHeader:t?l=>t.headers.get(l):k,httpStatus:(t==null?void 0:t.status)??200,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function St(e,t,r){var i;if(e.redoRequest)return e.redoRequest=!1,!1;const n=e.params.requestOptions;if(!t||n.responseType==="native"||n.responseType==="native-request-init")return!0;let s,o;if(r&&(r.error?s=r.error:r.status==="error"&&Array.isArray(r.messages)&&(s={...r},s[B]=r,s.details=r.messages)),!s&&!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[B]=r,s;let a,l=null;s&&(o=Number(s.code),l=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a==null?void 0:a.toUpperCase());const u=n.authMode;if(o===403&&(l===4||(i=s.message)!=null&&i.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(u!=="no-prompt"||o===498)&&o!==void 0&&wt.has(o)&&!be(e.params.url)&&(o!==403||(!a||!$t.has(a))&&(l==null||l===2&&e.credentialToken))){await K();try{const c=await d.getCredential(e.params.url,{error:b("request:server",s,e.params),prompt:u!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=c,e.credentialToken=c.token,e.useSSL=e.useSSL||c.ssl,!1}catch(c){if(u==="no-prompt")return e.credential=void 0,e.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function ce(e,t,r=!1){const n=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=m.priority,s.src=e,ht(s,e,r,n)}w._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],w._beforeFetch=void 0,w._afterFetch=void 0;export{re as $,Jt as A,oe as B,ye as C,ze as D,W as E,E as F,Dt as G,Vt as H,v as I,Pt as J,L as K,ht as L,Ge as M,jt as N,Zt as O,Kt as P,Ft as Q,Mt as R,Gt as S,Qt as T,w as U,Ke as V,It as W,R as Y,Z,de as _,Y as a,d as b,ft as c,Ee as d,V as e,Xt as f,_t as g,Te as h,ut as i,N as j,at as k,Wt as l,Xe as m,Yt as n,D as o,q as p,zt as q,lt as r,Ht as s,ee as t,Bt as u,T as v,Nt as w,C as x,rt as y,At as z};
