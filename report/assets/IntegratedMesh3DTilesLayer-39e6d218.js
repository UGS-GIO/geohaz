import{e as c,c as j}from"./subclass-f7409b1b.js";import{U as z}from"./request-a10d6950.js";import{a as V,s as S}from"./Error-21d1d076.js";import{M as A,r as x,i as W,j as p,O as I,d as D,D as N,C as T,K as y,n as g}from"./mathUtils-19b6edfc.js";import{m as k}from"./MultiOriginJSONSupport-9bd581c6.js";import{p as R}from"./promiseUtils-1d963c7c.js";import{y as u}from"./JSONSupport-acf2865c.js";import"./typedArrayUtil-2af43698.js";import{f as b,u as $}from"./SpatialReference-428523ee.js";import{M as w}from"./Extent-2b4578b8.js";import{n as M}from"./projectBuffer-af7b4ad9.js";import{b as F}from"./Layer-668dff8a.js";import{i as G}from"./APIKeyMixin-7c0d27b5.js";import{l as K}from"./ArcGISService-1a65aba0.js";import{e as O}from"./CustomParametersMixin-882f293c.js";import{u as P}from"./OperationalLayer-04352719.js";import{j as X}from"./PortalLayer-f8b97b56.js";import{t as q}from"./ScaleRangeLayer-61383a56.js";import{f as C,d as Z}from"./commonProperties-0c35c2c9.js";import{I as U,x as B,Z as H}from"./elevationInfoUtils-a8638c06.js";import"./time-0817624a.js";import"./jsonMap-5ba4a9c2.js";import"./assets-6fd92e57.js";import"./cast-e7a2f9aa.js";import"./geometry-31b45acd.js";import"./Polyline-013cde1f.js";import"./aaBoundingRect-aef00841.js";import"./Axis-30be7e73.js";import"./typeUtils-3056a943.js";import"./Evented-b5127116.js";import"./Identifiable-1430bdc2.js";import"./Loadable-8a1ead8b.js";import"./Promise-ec74e14b.js";import"./arcgisLayerUrl-0c479f71.js";import"./persistableUrlUtils-ca6bb38d.js";import"./layerUtils-c805b05c.js";import"./Portal-cb507469.js";import"./locale-bde6d0f6.js";import"./PortalItem-9d3416e3.js";import"./portalItemUtils-8aceb0b8.js";import"./projection-41da473c.js";import"./SimpleObservable-ae589a25.js";import"./zscale-d7e12601.js";import"./TimeExtent-579f0e32.js";import"./timeUtils-24502426.js";import"./date-7940da18.js";import"./datetime-7e00d9ef.js";import"./ElevationInfo-e9f55e40.js";import"./fieldUtils-fcb2a714.js";import"./intl-fe039018.js";import"./messages-2d262041.js";import"./lengthUtils-1e9c410b.js";import"./opacityUtils-f0a081b4.js";let l=class extends K(P(X(q(k(O(G(F))))))){constructor(i){super(i),this.operationalLayerType="IntegratedMesh3DTilesLayer",this.spatialReference=new b({wkid:4326,vcsWkid:115700}),this.fullExtent=new w(-180,-90,180,90,this.spatialReference),this.url=null,this.type="integrated-mesh-3dtiles",this.path=null,this.minScale=0,this.maxScale=0}set elevationInfo(i){this._set("elevationInfo",i),this._validateElevationInfo()}_verifyArray(i,r){if(!Array.isArray(i)||i.length<r)return!1;for(const n of i)if(typeof n!="number")return!1;return!0}_initFullExtent(i){var E,L;const r=(E=i.root)==null?void 0:E.boundingVolume;if(!r)return;if(r.box){const t=r==null?void 0:r.box;if(t[3]>7972671&&t[7]>7972671&&t[11]>7945940)return}const n=(L=i.root)==null?void 0:L.transform,h=g();if(r.region&&this._verifyArray(r.region,6)){const t=r.region,m=A(t[0]),s=A(t[1]),o=t[4],a=A(t[2]),e=A(t[3]),f=t[5];this.fullExtent=new w({xmin:m,ymin:s,zmin:o,xmax:a,ymax:e,zmax:f,spatialReference:this.spatialReference})}else if(r.sphere&&this._verifyArray(r.sphere,4)){const t=r.sphere,m=x(t[0],t[1],t[2]),s=t[3]/Math.sqrt(3),o=g();W(o,m,x(-s,-s,-s));const a=g();if(p(a,m,x(s,s,s)),n&&this._verifyArray(n,16)){const v=n;I(h,o,v),D(o,h),I(h,a,v),D(a,h)}M(o,$,0,o,b.WGS84,0,1),M(a,$,0,a,b.WGS84,0,1);const e=g(),f=g();N(e,o,a),T(f,o,a),this.fullExtent=new w({xmin:e[0],ymin:e[1],zmin:e[2],xmax:f[0],ymax:f[1],zmax:f[2],spatialReference:this.spatialReference})}else if(r.box&&this._verifyArray(r.box,12)){const t=r.box,m=x(t[0],t[1],t[2]),s=x(t[3],t[4],t[5]),o=x(t[6],t[7],t[8]),a=x(t[9],t[10],t[11]),e=[];for(let d=0;d<8;++d)e.push(g());if(p(e[0],m,s),p(e[0],e[0],o),p(e[0],e[0],a),y(e[1],m,s),p(e[1],e[1],o),p(e[1],e[1],a),p(e[2],m,s),y(e[2],e[2],o),p(e[2],e[2],a),y(e[3],m,s),y(e[3],e[3],o),p(e[3],e[3],a),p(e[4],m,s),p(e[4],e[4],o),y(e[4],e[4],a),y(e[5],m,s),p(e[5],e[5],o),y(e[5],e[5],a),p(e[6],m,s),y(e[6],e[6],o),y(e[6],e[6],a),y(e[7],m,s),y(e[7],e[7],o),y(e[7],e[7],a),n&&this._verifyArray(n,16)){const d=n;for(let _=0;_<8;++_)I(e[_],e[_],d)}const f=x(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),v=x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let d=0;d<8;++d)M(e[d],$,0,e[d],b.WGS84,0,1),N(v,v,e[d]),T(f,f,e[d]);this.fullExtent=new w({xmin:v[0],ymin:v[1],zmin:v[2],xmax:f[0],ymax:f[1],zmax:f[2],spatialReference:this.spatialReference})}}async load(i){return this.addResolvingPromise(this._doLoad(i)),this}async _doLoad(i){const r=i!=null?i.signal:null;try{await this.loadFromPortal({supportedTypes:["3DTiles Service"],validateItem:n=>{var h;if((h=n.typeKeywords)!=null&&h.includes("IntegratedMesh"))return!0;throw new V("portal:invalid-layer-item-type","Invalid layer item, expected '${expectedType}' ",{expectedType:"3DTiles Service containing IntegratedMesh"})}},i)}catch(n){R(n)}this.url&&await z(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:r}).then(h=>{this._initFullExtent(h.data)},h=>{R(h)})}async fetchAttributionData(){return this.load().then(()=>({}))}_validateElevationInfo(){const i=this.elevationInfo,r="Integrated mesh 3d tiles layers";U(S.getLogger(this),B(r,"absolute-height",i)),U(S.getLogger(this),H(r,i))}};c([u({type:["IntegratedMesh3DTilesLayer"]})],l.prototype,"operationalLayerType",void 0),c([u({type:b})],l.prototype,"spatialReference",void 0),c([u({type:w})],l.prototype,"fullExtent",void 0),c([u(C)],l.prototype,"elevationInfo",null),c([u({type:["show","hide"]})],l.prototype,"listMode",void 0),c([u(Z)],l.prototype,"url",void 0),c([u({readOnly:!0})],l.prototype,"type",void 0),c([u({type:String,json:{origins:{"web-scene":{read:!0,write:!0},"portal-item":{read:!0,write:!0}},read:!1}})],l.prototype,"path",void 0),c([u({type:Number,json:{origins:{"web-scene":{name:"layerDefinition.minScale",write:()=>{},read:()=>{}},"portal-item":{name:"layerDefinition.minScale",write:()=>{},read:()=>{}}}}})],l.prototype,"minScale",void 0),c([u({type:Number,json:{origins:{"web-scene":{name:"layerDefinition.maxScale",write:()=>{},read:()=>{}},"portal-item":{name:"layerDefinition.maxScale",write:()=>{},read:()=>{}}}}})],l.prototype,"maxScale",void 0),l=c([j("esri.layers.IntegratedMesh3DTilesLayer")],l);const He=l;export{He as default};
