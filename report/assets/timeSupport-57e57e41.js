import{_ as j}from"./request-a10d6950.js";import{s as K}from"./jsonMap-5ba4a9c2.js";import{G as M,w as b,N as d,X as Y,A as k,v as T}from"./SpatialReference-428523ee.js";import{W as O,I as X,H as Q}from"./projection-41da473c.js";import{d as ee}from"./Polyline-013cde1f.js";import{y as te,m as h,f as x,s as re,p as ne}from"./jsonUtils-2c7f966c.js";import{R as ie}from"./normalizeUtils-059b11cb.js";import{a as $}from"./Error-21d1d076.js";import{a as se,y as oe,b as Z,c as ae,Z as le,t as ue,r as me}from"./Extent-2b4578b8.js";import{h as ce,a as G,I as fe,x as v,$ as pe,H as he,U as ye,K as A}from"./featureConversionUtils-e62978d0.js";import{e as R}from"./OptimizedGeometry-5ad221bf.js";import{q as Re}from"./typedArrayUtil-2af43698.js";import{L as Se}from"./promiseUtils-1d963c7c.js";import{t as q}from"./json-48e3ea08.js";const E=new R,ge=new R,I=new R,f={esriGeometryPoint:v,esriGeometryPolyline:pe,esriGeometryPolygon:he,esriGeometryMultipoint:ye};function Qe(e,t,r,n=e.hasZ,i=e.hasM){if(t==null)return null;const s=e.hasZ&&n,o=e.hasM&&i;if(r){const a=G(I,t,e.hasZ,e.hasM,"esriGeometryPoint",r,n,i);return v(a,s,o)}return v(t,s,o)}function g(e,t,r,n,i,s,o=t,a=r){var y,p,S;const l=t&&o,u=r&&a,m=n!=null?"coords"in n?n:n.geometry:null;if(m==null)return null;if(i){let c=ce(ge,m,t,r,e,i,o,a);return s&&(c=G(I,c,l,u,e,s)),((y=f[e])==null?void 0:y.call(f,c,l,u))??null}if(s){const c=G(I,m,t,r,e,s,o,a);return((p=f[e])==null?void 0:p.call(f,c,l,u))??null}return fe(E,m,t,r,o,a),((S=f[e])==null?void 0:S.call(f,E,l,u))??null}function et(e){return e&&z in e?JSON.parse(JSON.stringify(e,de)):e}const z="_geVersion",de=(e,t)=>e!==z?t:void 0,_=[0,0];function C(e,t){if(!t)return null;if("x"in t){const r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,_),t.z!=null&&(r.z=t.z),t.m!=null&&(r.m=t.m),r}if("xmin"in t){const r={xmin:0,ymin:0,xmax:0,ymax:0};return[r.xmin,r.ymin]=e(t.xmin,t.ymin,_),[r.xmax,r.ymax]=e(t.xmax,t.ymax,_),t.hasZ&&(r.zmin=t.zmin,r.zmax=t.zmax,r.hasZ=!0),t.hasM&&(r.mmin=t.mmin,r.mmax=t.mmax,r.hasM=!0),r}return"rings"in t?{rings:F(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:F(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:V(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function F(e,t){const r=[];for(const n of e)r.push(V(n,t));return r}function V(e,t){const r=[];for(const n of e){const i=t(n[0],n[1],[0,0]);r.push(i),n.length>2&&i.push(n[2]),n.length>3&&i.push(n[3])}return r}async function P(e,t){if(!e||!t)return;const r=Array.isArray(e)?e.map(n=>n.geometry!=null?n.geometry.spatialReference:null).filter(Re):[e];await X(r.map(n=>({source:n,dest:t})))}const D=C.bind(null,se),J=C.bind(null,oe);function L(e,t,r,n){if(!e||(r||(r=t,t=e.spatialReference),!d(t)||!d(r)||M(t,r)))return e;if(Z(t,r)){const i=b(r)?D(e):J(e);return i.spatialReference=r,i}return O(q,[e],t,r,null,n)[0]}class xe{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(t,r,n,i){if(!(t!=null&&t.length)||!r||!n||M(r,n))return t;const s={geometries:t,inSpatialReference:r,outSpatialReference:n,geographicTransformation:i,resolve:Se()};return this._jobs.push(s),this._timer??(this._timer=setTimeout(this._process,10)),s.resolve.promise}_process(){this._timer=null;const t=this._jobs.shift();if(!t)return;const{geometries:r,inSpatialReference:n,outSpatialReference:i,resolve:s,geographicTransformation:o}=t;Z(n,i)?b(i)?s(r.map(D)):s(r.map(J)):s(O(q,r,n,i,o,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}const $e=new xe;function tt(e,t,r,n){return $e.push(e,t,r,n)}const _e=new K({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),U=Object.freeze({});async function rt(e,t,r){const{outFields:n,orderByFields:i,groupByFieldsForStatistics:s,outStatistics:o}=e;if(n)for(let a=0;a<n.length;a++)n[a]=n[a].trim();if(i)for(let a=0;a<i.length;a++)i[a]=i[a].trim();if(s)for(let a=0;a<s.length;a++)s[a]=s[a].trim();if(o)for(let a=0;a<o.length;a++)o[a].onStatisticField&&(o[a].onStatisticField=o[a].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),we(e,t,r)}async function we(e,t,r){var s;if(!e)return null;let{where:n}=e;if(e.where=n=n==null?void 0:n.trim(),(!n||/^1 *= *1$/.test(n)||t&&t===n)&&(e.where=null),!e.geometry)return e;let i=await ve(e);if(e.distance=0,e.units=null,e.spatialRel==="esriSpatialRelEnvelopeIntersects"){const{spatialReference:o}=e.geometry;i=ee(i),i.spatialReference=o}if(i){await P(i.spatialReference,r),i=Ge(i,r);const o=(await ie(te(i)))[0];if(o==null)throw U;const a="quantizationParameters"in e&&((s=e.quantizationParameters)==null?void 0:s.tolerance)||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,l=a&&B(i,r)?{densificationStep:8*a}:void 0,u=o.toJSON(),m=L(u,u.spatialReference,r,l);if(!m)throw U;m.spatialReference=r,e.geometry=m}return e}function B(e,t){if(!e)return!1;const r=e.spatialReference;return(h(e)||x(e)||re(e))&&!M(r,t)&&!Q(r,t)}function Ge(e,t){const r=e.spatialReference;return B(e,t)&&h(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}async function ve(e){const{distance:t,units:r}=e,n=e.geometry;if(t==null||"vertexAttributes"in n)return n;const i=n.spatialReference,s=r?_e.fromJSON(r):Y(i),o=i&&(k(i)||b(i))?n:await P(i,T).then(()=>L(n,T));return(await Ie())(o.spatialReference,o,t,s)}async function Ie(){return(await j(()=>import("./geometryEngineJSON-654a74ef.js"),["./geometryEngineJSON-654a74ef.js","./geometryEngineBase-77e94ca5.js","./_commonjsHelpers-2f3e7994.js","./geometryEngineJSON-ec02ed97.js","./json-48e3ea08.js"],import.meta.url)).geodesicBuffer}function Me(e){return e==="mesh"?ae:le(e)}function H(e,t){return e?t?4:3:t?3:2}function be(e,t,r,n){return W(e,t,r,n.coords[0],n.coords[1])}function Pe(e,t,r,n,i,s){const o=H(i,s),{coords:a,lengths:l}=n;if(!l)return!1;for(let u=0,m=0;u<l.length;u++,m+=o)if(!W(e,t,r,a[m],a[m+1]))return!1;return!0}function W(e,t,r,n,i){if(!e)return!1;const s=H(t,r),{coords:o,lengths:a}=e;let l=!1,u=0;for(const m of a)l=Ne(l,o,s,u,m,n,i),u+=m*s;return l}function Ne(e,t,r,n,i,s,o){let a=e,l=n;for(let u=n,m=n+i*r;u<m;u+=r){l=u+r,l===m&&(l=n);const y=t[u],p=t[u+1],S=t[l],c=t[l+1];(p<o&&c>=o||c<o&&p>=o)&&y+(o-p)/(c-p)*(S-y)<s&&(a=!a)}return a}const w="unsupported-query",Te={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},N={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function Ae(e){return e!=null&&N.spatialRelationship[e]===!0}function Ee(e){return e!=null&&N.queryGeometry[ne(e)]===!0}function Fe(e){return e!=null&&N.layerGeometry[e]===!0}function Ue(){return j(()=>import("./geometryEngineJSON-654a74ef.js"),["./geometryEngineJSON-654a74ef.js","./geometryEngineBase-77e94ca5.js","./_commonjsHelpers-2f3e7994.js","./geometryEngineJSON-ec02ed97.js","./json-48e3ea08.js"],import.meta.url)}function nt(e,t,r,n,i){if(x(t)&&r==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains")){const s=A(new R,t,!1,!1);return Promise.resolve(o=>be(s,!1,!1,o))}if(x(t)&&r==="esriGeometryMultipoint"){const s=A(new R,t,!1,!1);if(e==="esriSpatialRelContains")return Promise.resolve(o=>Pe(s,!1,!1,o,n,i))}if(h(t)&&r==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains"))return Promise.resolve(s=>ue(t,g(r,n,i,s)));if(h(t)&&r==="esriGeometryMultipoint"&&e==="esriSpatialRelContains")return Promise.resolve(s=>me(t,g(r,n,i,s)));if(h(t)&&e==="esriSpatialRelIntersects"){const s=Me(r);return Promise.resolve(o=>s(t,g(r,n,i,o)))}return Ue().then(s=>{const o=s[Te[e]].bind(null,t.spatialReference,t);return a=>o(g(r,n,i,a))})}async function it(e,t,r){var s;const{spatialRel:n,geometry:i}=e;if(i){if(!Ae(n))throw new $(w,"Unsupported query spatial relationship",{query:e});if(d(i.spatialReference)&&d(r)){if(!Ee(i))throw new $(w,"Unsupported query geometry type",{query:e});if(!Fe(t))throw new $(w,"Unsupported layer geometry type",{query:e});if(e.outSR)return P((s=e.geometry)==null?void 0:s.spatialReference,e.outSR)}}}function st(e){if(h(e))return!0;if(x(e)){for(const t of e.rings)if(t.length!==5||t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1;return!0}return!1}async function ot(e,t){if(!e)return null;const r=t.featureAdapter,{startTimeField:n,endTimeField:i}=e;let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;if(n&&i)await t.forEach(a=>{const l=r.getAttribute(a,n),u=r.getAttribute(a,i);l==null||isNaN(l)||(s=Math.min(s,l)),u==null||isNaN(u)||(o=Math.max(o,u))});else{const a=n||i;await t.forEach(l=>{const u=r.getAttribute(l,a);u==null||isNaN(u)||(s=Math.min(s,u),o=Math.max(o,u))})}return{start:s,end:o}}function at(e,t,r){var l;if(!t||!e)return null;const{startTimeField:n,endTimeField:i}=e;if(!n&&!i)return null;const{start:s,end:o}=t;if(s===null&&o===null)return null;if(s===void 0&&o===void 0)return Ze();const a=((l=r.getAttributeAsTimestamp)==null?void 0:l.bind(r))??r.getAttribute.bind(r);return n&&i?je(a,n,i,s,o):Oe(a,n||i,s,o)}function je(e,t,r,n,i){return n!=null&&i!=null?s=>{const o=e(s,t),a=e(s,r);return(o==null||o<=i)&&(a==null||a>=n)}:n!=null?s=>{const o=e(s,r);return o==null||o>=n}:i!=null?s=>{const o=e(s,t);return o==null||o<=i}:void 0}function Oe(e,t,r,n){return r!=null&&n!=null&&r===n?i=>e(i,t)===r:r!=null&&n!=null?i=>{const s=e(i,t);return s!=null&&s>=r&&s<=n}:r!=null?i=>{const s=e(i,t);return s!=null&&s>=r}:n!=null?i=>{const s=e(i,t);return s!=null&&s<=n}:void 0}function Ze(){return()=>!1}export{st as I,it as P,rt as S,we as a,g as b,tt as c,U as g,et as h,L as j,ot as n,at as t,nt as v,P as x,Qe as y};
